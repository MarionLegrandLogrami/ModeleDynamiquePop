% 
\documentclass[a4paper]{article}
\usepackage{Sweave}
\usepackage[latin1]{inputenc} %encodage du fichier source
\usepackage[T1]{fontenc}  %gestion des accents (pour les pdf) 
\usepackage[francais]{babel}
\usepackage{float}
\usepackage[section]{placeins}%The placeins package provides the command \FloatBarrier 
\usepackage{amsmath} % equation numbering
\usepackage[colorlinks=true,urlcolor=blue,linkcolor=black,citecolor=black]{hyperref}
\usepackage{wrapfig}
\usepackage{subcaption} % pour les subfigures
\usepackage{vmargin}
\setpapersize{A4}
\setmarginsrb{15mm}{15mm}{15mm}{15mm}{12pt}{0mm}{0pt}{11mm}
\pagestyle{empty}
%1 est la marge gauche
%2 est la marge en haut
%3 est la marge droite
%4 est la marge en bas
%5 fixe la hauteur de l'entête
%6 fixe la distance entre l'entête et le texte
%7 fixe la hauteur du pied de page
%8 fixe la distance entre le texte et le pied de page

\title{Comparaison des modèles retrospectifs + simulations - Version V\_1}
\author{Marion Legrand,\\Guillaume Dauphin,\\Etienne Prevost}

\begin{document}
\maketitle
\newpage

<< Init_AnalyseRetro, echo=FALSE, eval=FALSE,results=hide >>=
setwd("C:/Users/LOGRAMI/workspace/ModeleDynamiquePop")
un<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/2014_05_30/" #Modèle Guillaume 2014.05.30
deux<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/2014_09/SurfErrSeul/"#SurfErrSeul
trois<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/2014_09/"#SurfERR+SurfDev
imgwd<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_05_30/"
imgwddeux<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_09_26SurfERR+SurfDev/"
imgwdtrois<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_09_26SurfERR+SurfDev/"



library(lattice)
library(coda)
library(boot)
require(stringr)

T=39

S_juv_JP_anc=c(2574236,434552,655661)
surf=c(rep(c(916866,250441,0),11),rep(c(916866,250441,301101),12),rep(c(916866,250441,383049),6),rep(c(1202540,250441,383049),31))
S_juv_JP<-matrix(surf,nrow=3)

#taking coda of the first 6 years of Returns to Vichy
N_vichy_inits_un=read.coda(str_c(un,"N_VichyCODAchain1.txt"),str_c(un,"N_VichyCODAindex.txt"))
N_vichy_inits_deux=read.coda(str_c(deux,"N_VichyCODAchain1.txt"),str_c(deux,"N_VichyCODAindex.txt"))
N_vichy_inits_trois=read.coda(str_c(trois,"N_VichyCODAchain1.txt"),str_c(trois,"N_VichyCODAindex.txt"))

#taking coda of the first 6 years of p_langeac
p_langeac_inits_un=read.coda(str_c(un,"p_langeacCODAchain1.txt"),str_c(un,"p_langeacCODAindex.txt"))
p_langeac_inits_deux=read.coda(str_c(deux,"p_langeacCODAchain1.txt"),str_c(deux,"p_langeacCODAindex.txt"))
p_langeac_inits_trois=read.coda(str_c(trois,"p_langeacCODAchain1.txt"),str_c(trois,"p_langeacCODAindex.txt"))

#others parameters required
s_juv2ad_un=read.coda(str_c(un,"s_juv2adCODAchain1.txt"),str_c(un,"s_juv2adCODAindex.txt"))
s_juv2ad_deux=read.coda(str_c(deux,"s_juv2adCODAchain1.txt"),str_c(deux,"s_juv2adCODAindex.txt"))
s_juv2ad_trois=read.coda(str_c(trois,"s_juv2adCODAchain1.txt"),str_c(trois,"s_juv2adCODAindex.txt"))

level_s_un=read.coda(str_c(un,"simulation/level_sCODAchain1.txt"),str_c(un,"simulation/level_sCODAindex.txt")) 
level_s_deux=read.coda(str_c(deux,"simulation/level_sCODAchain1.txt"),str_c(deux,"simulation/level_sCODAindex.txt"))
level_s_trois=read.coda(str_c(trois,"simulation/level_sCODAchain1.txt"),str_c(trois,"simulation/level_sCODAindex.txt"))

I_surv_un=read.coda(str_c(un,"simulation/I_survCODAchain1.txt"),str_c(un,"simulation/I_survCODAindex.txt"))
I_surv_deux=read.coda(str_c(deux,"simulation/I_survCODAchain1.txt"),str_c(deux,"simulation/I_survCODAindex.txt"))
I_surv_trois=read.coda(str_c(trois,"simulation/I_survCODAchain1.txt"),str_c(trois,"simulation/I_survCODAindex.txt"))

rho_station_un=read.coda(str_c(un,"rho_stationCODAchain1.txt"),str_c(un,"rho_stationCODAindex.txt"))
rho_station_deux=read.coda(str_c(deux,"rho_stationCODAchain1.txt"),str_c(deux,"rho_stationCODAindex.txt"))
rho_station_trois=read.coda(str_c(trois,"rho_stationCODAchain1.txt"),str_c(trois,"rho_stationCODAindex.txt"))

alpha_dd_un=read.coda(str_c(un,"simulation/alpha_ddCODAchain1.txt"),str_c(un,"simulation/alpha_ddCODAindex.txt"))
alpha_dd_deux=read.coda(str_c(deux,"simulation/alpha_ddCODAchain1.txt"),str_c(deux,"simulation/alpha_ddCODAindex.txt"))
alpha_dd_trois=read.coda(str_c(trois,"simulation/alpha_ddCODAchain1.txt"),str_c(trois,"simulation/alpha_ddCODAindex.txt"))

beta_dd_un=read.coda(str_c(un,"simulation/beta_ddCODAchain1.txt"),str_c(un,"simulation/beta_ddCODAindex.txt"))
beta_dd_deux=read.coda(str_c(deux,"simulation/beta_ddCODAchain1.txt"),str_c(deux,"simulation/beta_ddCODAindex.txt"))
beta_dd_trois=read.coda(str_c(trois,"simulation/beta_ddCODAchain1.txt"),str_c(trois,"simulation/beta_ddCODAindex.txt"))

nu_wild_un=read.coda(str_c(un,"nu_wildCODAchain1.txt"),str_c(un,"nu_wildCODAindex.txt"))
nu_wild_deux=read.coda(str_c(deux,"nu_wildCODAchain1.txt"),str_c(deux,"nu_wildCODAindex.txt"))
nu_wild_trois=read.coda(str_c(trois,"nu_wildCODAchain1.txt"),str_c(trois,"nu_wildCODAindex.txt"))

res_wild_vichy_un=read.coda(str_c(un,"simulation/res_wild_vichyCODAchain1.txt"),str_c(un,"simulation/res_wild_vichyCODAindex.txt"))
res_wild_vichy_deux=read.coda(str_c(deux,"simulation/res_wild_vichyCODAchain1.txt"),str_c(deux,"simulation/res_wild_vichyCODAindex.txt"))
res_wild_vichy_trois=read.coda(str_c(trois,"simulation/res_wild_vichyCODAchain1.txt"),str_c(trois,"simulation/res_wild_vichyCODAindex.txt"))

res_wild_langeac_un=read.coda(str_c(un,"simulation/res_wild_langeacCODAchain1.txt"),str_c(un,"simulation/res_wild_langeacCODAindex.txt "))
res_wild_langeac_deux=read.coda(str_c(deux,"simulation/res_wild_langeacCODAchain1.txt"),str_c(deux,"simulation/res_wild_langeacCODAindex.txt "))
res_wild_langeac_trois=read.coda(str_c(trois,"simulation/res_wild_langeacCODAchain1.txt"),str_c(trois,"simulation/res_wild_langeacCODAindex.txt "))

res_wild_poutes_un=read.coda(str_c(un,"simulation/res_wild_poutesCODAchain1.txt"),str_c(un,"simulation/res_wild_poutesCODAindex.txt "))
res_wild_poutes_deux=read.coda(str_c(deux,"simulation/res_wild_poutesCODAchain1.txt"),str_c(deux,"simulation/res_wild_poutesCODAindex.txt "))
res_wild_poutes_trois=read.coda(str_c(trois,"simulation/res_wild_poutesCODAchain1.txt"),str_c(trois,"simulation/res_wild_poutesCODAindex.txt "))

S_vichy_un=array(0,dim=c(5000,T))
S_vichy_deux=array(0,dim=c(5000,T))
S_vichy_trois=array(0,dim=c(5000,T))

S_langeac_un=array(0,dim=c(5000,T))
S_langeac_deux=array(0,dim=c(5000,T))
S_langeac_trois=array(0,dim=c(5000,T))

S_poutes_un=array(0,dim=c(5000,T))
S_poutes_deux=array(0,dim=c(5000,T))
S_poutes_trois=array(0,dim=c(5000,T))

N_langeac_un=array(0,dim=c(5000,T))
N_langeac_deux=array(0,dim=c(5000,T))
N_langeac_trois=array(0,dim=c(5000,T))

N_poutes_un=array(0,dim=c(5000,T))
N_poutes_deux=array(0,dim=c(5000,T))
N_poutes_trois=array(0,dim=c(5000,T))

d_moy_vichy_un=array(0,dim=c(5000,T+1))
d_moy_vichy_deux=array(0,dim=c(5000,T+1))
d_moy_vichy_trois=array(0,dim=c(5000,T+1))

d_moy_langeac_un=array(0,dim=c(5000,T+1))
d_moy_langeac_deux=array(0,dim=c(5000,T+1))
d_moy_langeac_trois=array(0,dim=c(5000,T+1))

d_moy_poutes_un=array(0,dim=c(5000,T+1))
d_moy_poutes_deux=array(0,dim=c(5000,T+1))
d_moy_poutes_trois=array(0,dim=c(5000,T+1))

juv_vichy_un=array(0,dim=c(5000,T+1))
juv_vichy_deux=array(0,dim=c(5000,T+1))
juv_vichy_trois=array(0,dim=c(5000,T+1))

juv_langeac_un=array(0,dim=c(5000,T+1))
juv_langeac_deux=array(0,dim=c(5000,T+1))
juv_langeac_trois=array(0,dim=c(5000,T+1))

juv_poutes_un=array(0,dim=c(5000,T+1))
juv_poutes_deux=array(0,dim=c(5000,T+1))
juv_poutes_trois=array(0,dim=c(5000,T+1))

juv_tot_vichy_un=array(0,dim=c(5000,T+1))
juv_tot_vichy_deux=array(0,dim=c(5000,T+1))
juv_tot_vichy_trois=array(0,dim=c(5000,T+1))

juv_tot_langeac_un=array(0,dim=c(5000,T+1))
juv_tot_langeac_deux=array(0,dim=c(5000,T+1))
juv_tot_langeac_trois=array(0,dim=c(5000,T+1))

juv_tot_poutes_un=array(0,dim=c(5000,T+1))
juv_tot_poutes_deux=array(0,dim=c(5000,T+1))
juv_tot_poutes_trois=array(0,dim=c(5000,T+1))

juv_tot_system_un=array(0,dim=c(5000,T+1))
juv_tot_system_deux=array(0,dim=c(5000,T+1))
juv_tot_system_trois=array(0,dim=c(5000,T+1))

ratio_habitat_un=c(0,0,0)
ratio_habitat_deux=array(0,dim=c(T,3))
ratio_habitat_trois=array(0,dim=c(T,3))

for (i in 1:3){
	ratio_habitat_un[i] = S_juv_JP_anc[i] /sum( S_juv_JP_anc[])
}


for(t in 1:T){
	for (i in 1:3){
	ratio_habitat_deux[t,i]=S_juv_JP[i,t]/( S_juv_JP[1,t]+S_juv_JP[2,t]+S_juv_JP[3,t])
	ratio_habitat_trois[t,i]=S_juv_JP[i,t]/( S_juv_JP[1,t]+S_juv_JP[2,t]+S_juv_JP[3,t])#sum(S_juv_JP[,t])
	}
}

ratio_juv_prod_V_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_V_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_V_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_prod_L_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_L_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_L_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_prod_P_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_P_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_P_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_V_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_V_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_V_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_L_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_L_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_L_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_P_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_P_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_P_trois=array(rep(0,T*5000),dim=c(5000,T))


res_p_langeac_un=read.coda(str_c(un,"simulation/res_p_langeacCODAchain1.txt"),str_c(un,"simulation/res_p_langeacCODAindex.txt"))
res_p_langeac_deux=read.coda(str_c(deux,"simulation/res_p_langeacCODAchain1.txt"),str_c(deux,"simulation/res_p_langeacCODAindex.txt"))
res_p_langeac_trois=read.coda(str_c(trois,"simulation/res_p_langeacCODAchain1.txt"),str_c(trois,"simulation/res_p_langeacCODAindex.txt"))

res_p_poutes_un=read.coda(str_c(un,"simulation/res_p_poutesCODAchain1.txt"),str_c(un,"simulation/res_p_poutesCODAindex.txt "))
res_p_poutes_deux=read.coda(str_c(deux,"simulation/res_p_poutesCODAchain1.txt"),str_c(deux,"simulation/res_p_poutesCODAindex.txt "))
res_p_poutes_trois=read.coda(str_c(trois,"simulation/res_p_poutesCODAchain1.txt"),str_c(trois,"simulation/res_p_poutesCODAindex.txt "))

adjust_p_L_un=read.coda(str_c(un,"simulation/adjust_p_LCODAchain1.txt"),str_c(un,"simulation/adjust_p_LCODAindex.txt"))
adjust_p_L_deux=read.coda(str_c(deux,"simulation/adjust_p_LCODAchain1.txt"),str_c(deux,"simulation/adjust_p_LCODAindex.txt"))
adjust_p_L_trois=read.coda(str_c(trois,"simulation/adjust_p_LCODAchain1.txt"),str_c(trois,"simulation/adjust_p_LCODAindex.txt"))

adjust_p_P_un=read.coda(str_c(un,"simulation/adjust_p_PCODAchain1.txt"),str_c(un,"simulation/adjust_p_PCODAindex.txt"))
adjust_p_P_deux=read.coda(str_c(deux,"simulation/adjust_p_PCODAchain1.txt"),str_c(deux,"simulation/adjust_p_PCODAindex.txt"))
adjust_p_P_trois=read.coda(str_c(trois,"simulation/adjust_p_PCODAchain1.txt"),str_c(trois,"simulation/adjust_p_PCODAindex.txt"))


p_langeac_un=array(0,185,dim=c(5000,T))
p_langeac_deux=array(0,185,dim=c(5000,T))
p_langeac_trois=array(0,185,dim=c(5000,T))

p_poutes_un=array(0,185,dim=c(5000,T))
p_poutes_deux=array(0,185,dim=c(5000,T))
p_poutes_trois=array(0,185,dim=c(5000,T))


N_vichy_un=array(0,185,dim=c(5000,T))
N_vichy_deux=array(0,185,dim=c(5000,T))
N_vichy_trois=array(0,185,dim=c(5000,T))

res_vichy_un=read.coda(str_c(un,"simulation/res_vichyCODAchain1.txt"),str_c(un,"simulation/res_vichyCODAindex.txt"))
res_vichy_deux=read.coda(str_c(deux,"simulation/res_vichyCODAchain1.txt"),str_c(deux,"simulation/res_vichyCODAindex.txt"))
res_vichy_trois=read.coda(str_c(trois,"simulation/res_vichyCODAchain1.txt"),str_c(trois,"simulation/res_vichyCODAindex.txt"))

juv_tot_sys_un=read.coda(str_c(un,"simulation/juv_tot_sysCODAchain1.txt"),str_c(un,"simulation/juv_tot_sysCODAindex.txt"))
juv_tot_sys_deux=read.coda(str_c(deux,"simulation/juv_tot_sysCODAchain1.txt"),str_c(deux,"simulation/juv_tot_sysCODAindex.txt"))
juv_tot_sys_trois=read.coda(str_c(trois,"simulation/juv_tot_sysCODAchain1.txt"),str_c(trois,"simulation/juv_tot_sysCODAindex.txt"))


ratio_juv_prod_L_inits_un=read.coda(str_c(un,"simulation/ratio_juv_prod_LCODAchain1.txt"),str_c(un,"simulation/ratio_juv_prod_LCODAindex.txt"))
ratio_juv_prod_L_inits_deux=read.coda(str_c(deux,"simulation/ratio_juv_prod_LCODAchain1.txt"),str_c(deux,"simulation/ratio_juv_prod_LCODAindex.txt"))
ratio_juv_prod_L_inits_trois=read.coda(str_c(trois,"simulation/ratio_juv_prod_LCODAchain1.txt"),str_c(trois,"simulation/ratio_juv_prod_LCODAindex.txt"))

p_reach_V_un=read.coda(str_c(un,"p_reach_VCODAchain1.txt"),str_c(un,"p_reach_VCODAindex.txt"))
p_reach_V_deux=read.coda(str_c(deux,"p_reach_VCODAchain1.txt"),str_c(deux,"p_reach_VCODAindex.txt"))
p_reach_V_trois=read.coda(str_c(trois,"p_reach_VCODAchain1.txt"),str_c(trois,"p_reach_VCODAindex.txt"))

C_dwn=c(
		420,439,77,124,190,
		318,819,388,169,286,
		438,614,385,731,260,
		196,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0)


C_up=c(
		1190,700,315,220,200,
		1280,514,1163,410,314,
		807,72,91,425,140,
		88,135,110,112,0,
		0,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0,0,
		0,0,0,0)


dmoy_tot_V_un=read.coda(str_c(un,"dmoytot_VCODAchain1.txt"),str_c(un,"dmoytot_VCODAindex.txt"))
dmoy_tot_V_deux=read.coda(str_c(deux,"dmoytot_VCODAchain1.txt"),str_c(deux,"dmoytot_VCODAindex.txt"))
dmoy_tot_V_trois=read.coda(str_c(trois,"dmoytot_VCODAchain1.txt"),str_c(trois,"dmoytot_VCODAindex.txt"))

dmoy_tot_L_un=read.coda(str_c(un,"dmoytot_LCODAchain1.txt"),str_c(un,"dmoytot_LCODAindex.txt"))
dmoy_tot_L_deux=read.coda(str_c(deux,"dmoytot_LCODAchain1.txt"),str_c(deux,"dmoytot_LCODAindex.txt"))
dmoy_tot_L_trois=read.coda(str_c(trois,"dmoytot_LCODAchain1.txt"),str_c(trois,"dmoytot_LCODAindex.txt"))

dmoy_tot_P_un=read.coda(str_c(un,"dmoytot_PCODAchain1.txt"),str_c(un,"dmoytot_PCODAindex.txt"))
dmoy_tot_P_deux=read.coda(str_c(deux,"dmoytot_PCODAchain1.txt"),str_c(deux,"dmoytot_PCODAindex.txt"))
dmoy_tot_P_trois=read.coda(str_c(trois,"dmoytot_PCODAchain1.txt"),str_c(trois,"dmoytot_PCODAindex.txt"))

dmoy_wild_V_un=read.coda(str_c(un,"dmoywild_VCODAchain1.txt"),str_c(un,"dmoywild_VCODAindex.txt"))
dmoy_wild_V_deux=read.coda(str_c(deux,"dmoywild_VCODAchain1.txt"),str_c(deux,"dmoywild_VCODAindex.txt"))
dmoy_wild_V_trois=read.coda(str_c(trois,"dmoywild_VCODAchain1.txt"),str_c(trois,"dmoywild_VCODAindex.txt"))

dmoy_wild_L_un=read.coda(str_c(un,"dmoywild_LCODAchain1.txt"),str_c(un,"dmoywild_LCODAindex.txt"))
dmoy_wild_L_deux=read.coda(str_c(deux,"dmoywild_LCODAchain1.txt"),str_c(deux,"dmoywild_LCODAindex.txt"))
dmoy_wild_L_trois=read.coda(str_c(trois,"dmoywild_LCODAchain1.txt"),str_c(trois,"dmoywild_LCODAindex.txt"))

dmoy_wild_P_un=read.coda(str_c(un,"dmoywild_PCODAchain1.txt"),str_c(un,"dmoywild_PCODAindex.txt"))
dmoy_wild_P_deux=read.coda(str_c(deux,"dmoywild_PCODAchain1.txt"),str_c(deux,"dmoywild_PCODAindex.txt"))
dmoy_wild_P_trois=read.coda(str_c(trois,"dmoywild_PCODAchain1.txt"),str_c(trois,"dmoywild_PCODAindex.txt"))

ratio_wild_un=array(0,dim=c(5000,T))
ratio_wild_deux=array(0,dim=c(5000,T))
ratio_wild_trois=array(0,dim=c(5000,T))

for (t in 7:15){
	for (i in 1:5000){	
		ratio_wild_un[i,t] = (dmoy_wild_V_un[i,t-6] + dmoy_wild_L_un[i,t-6] + dmoy_wild_V_un[i,t-5] + dmoy_wild_L_un[i,t-5] + dmoy_wild_V_un[i,t-4] + dmoy_wild_L_un[i,t-4]) / (dmoy_tot_V_un[i,t-6] + dmoy_tot_L_un[i,t-6] + dmoy_tot_V_un[i,t-5] + dmoy_tot_L_un[i,t-5] +dmoy_tot_V_un[i,t-4] + dmoy_tot_L_un[i,t-4])
		ratio_wild_deux[i,t] = (dmoy_wild_V_deux[i,t-6] + dmoy_wild_L_deux[i,t-6] + dmoy_wild_V_deux[i,t-5] + dmoy_wild_L_deux[i,t-5] + dmoy_wild_V_deux[i,t-4] + dmoy_wild_L_deux[i,t-4]) / (dmoy_tot_V_deux[i,t-6] + dmoy_tot_L_deux[i,t-6] + dmoy_tot_V_deux[i,t-5] + dmoy_tot_L_deux[i,t-5] +dmoy_tot_V_deux[i,t-4] + dmoy_tot_L_deux[i,t-4])
		ratio_wild_trois[i,t] = (dmoy_wild_V_trois[i,t-6] + dmoy_wild_L_trois[i,t-6] + dmoy_wild_V_trois[i,t-5] + dmoy_wild_L_trois[i,t-5] + dmoy_wild_V_trois[i,t-4] + dmoy_wild_L_trois[i,t-4]) / (dmoy_tot_V_trois[i,t-6] + dmoy_tot_L_trois[i,t-6] + dmoy_tot_V_trois[i,t-5] + dmoy_tot_L_trois[i,t-5] +dmoy_tot_V_trois[i,t-4] + dmoy_tot_L_trois[i,t-4])
		}
}

for (t in 16:16){
	for (i in 1:5000){	
		ratio_wild_un[i,t] = (dmoy_wild_V_un[i,t-6] + dmoy_wild_L_un[i,t-6] + dmoy_wild_V_un[i,t-5] + dmoy_wild_L_un[i,t-5] + dmoy_wild_V_un[i,t-4] + dmoy_wild_L_un[i,t-4] + dmoy_wild_P_un[i,t-13]) / (dmoy_tot_V_un[i,t-6] + dmoy_tot_L_un[i,t-6] + dmoy_tot_V_un[i,t-5] + dmoy_tot_L_un[i,t-5] +dmoy_tot_V_un[i,t-4] + dmoy_tot_L_un[i,t-4]+ dmoy_tot_P_un[i,t-13])
		ratio_wild_deux[i,t] = (dmoy_wild_V_deux[i,t-6] + dmoy_wild_L_deux[i,t-6] + dmoy_wild_V_deux[i,t-5] + dmoy_wild_L_deux[i,t-5] + dmoy_wild_V_deux[i,t-4] + dmoy_wild_L_deux[i,t-4] + dmoy_wild_P_deux[i,t-13]) / (dmoy_tot_V_deux[i,t-6] + dmoy_tot_L_deux[i,t-6] + dmoy_tot_V_deux[i,t-5] + dmoy_tot_L_deux[i,t-5] +dmoy_tot_V_deux[i,t-4] + dmoy_tot_L_deux[i,t-4]+ dmoy_tot_P_deux[i,t-13])
		ratio_wild_trois[i,t] = (dmoy_wild_V_trois[i,t-6] + dmoy_wild_L_trois[i,t-6] + dmoy_wild_V_trois[i,t-5] + dmoy_wild_L_trois[i,t-5] + dmoy_wild_V_trois[i,t-4] + dmoy_wild_L_trois[i,t-4] + dmoy_wild_P_trois[i,t-13]) / (dmoy_tot_V_trois[i,t-6] + dmoy_tot_L_trois[i,t-6] + dmoy_tot_V_trois[i,t-5] + dmoy_tot_L_trois[i,t-5] +dmoy_tot_V_trois[i,t-4] + dmoy_tot_L_trois[i,t-4]+ dmoy_tot_P_trois[i,t-13])
		
	}
}

for (t in 17:17){
	for (i in 1:5000){	
		ratio_wild_un[i,t] = (dmoy_wild_V_un[i,t-6] + dmoy_wild_L_un[i,t-6] + dmoy_wild_V_un[i,t-5] + dmoy_wild_L_un[i,t-5]+ dmoy_wild_P_un[i,t-14] + dmoy_wild_V_un[i,t-4] + dmoy_wild_L_un[i,t-4] + dmoy_wild_P_un[i,t-13]) / (dmoy_tot_V_un[i,t-6] + dmoy_tot_L_un[i,t-6] + dmoy_tot_V_un[i,t-5] + dmoy_tot_L_un[i,t-5]+ dmoy_tot_P_un[i,t-14] +dmoy_tot_V_un[i,t-4] + dmoy_tot_L_un[i,t-4]+ dmoy_tot_P_un[i,t-13])
		ratio_wild_deux[i,t] = (dmoy_wild_V_deux[i,t-6] + dmoy_wild_L_deux[i,t-6] + dmoy_wild_V_deux[i,t-5] + dmoy_wild_L_deux[i,t-5]+ dmoy_wild_P_deux[i,t-14] + dmoy_wild_V_deux[i,t-4] + dmoy_wild_L_deux[i,t-4] + dmoy_wild_P_deux[i,t-13]) / (dmoy_tot_V_deux[i,t-6] + dmoy_tot_L_deux[i,t-6] + dmoy_tot_V_deux[i,t-5] + dmoy_tot_L_deux[i,t-5]+ dmoy_tot_P_deux[i,t-14] +dmoy_tot_V_deux[i,t-4] + dmoy_tot_L_deux[i,t-4]+ dmoy_tot_P_deux[i,t-13])
		ratio_wild_trois[i,t] = (dmoy_wild_V_trois[i,t-6] + dmoy_wild_L_trois[i,t-6] + dmoy_wild_V_trois[i,t-5] + dmoy_wild_L_trois[i,t-5]+ dmoy_wild_P_trois[i,t-14] + dmoy_wild_V_trois[i,t-4] + dmoy_wild_L_trois[i,t-4] + dmoy_wild_P_trois[i,t-13]) / (dmoy_tot_V_trois[i,t-6] + dmoy_tot_L_trois[i,t-6] + dmoy_tot_V_trois[i,t-5] + dmoy_tot_L_trois[i,t-5]+ dmoy_tot_P_trois[i,t-14] +dmoy_tot_V_trois[i,t-4] + dmoy_tot_L_trois[i,t-4]+ dmoy_tot_P_trois[i,t-13])
	}
}

for (t in 18:39){
	for (i in 1:5000){	
		ratio_wild_un[i,t] = (dmoy_wild_V_un[i,t-6] + dmoy_wild_L_un[i,t-6]+ dmoy_wild_P_un[i,t-15] + dmoy_wild_V_un[i,t-5] + dmoy_wild_L_un[i,t-5]+ dmoy_wild_P_un[i,t-14] + dmoy_wild_V_un[i,t-4] + dmoy_wild_L_un[i,t-4] + dmoy_wild_P_un[i,t-13]) / (dmoy_tot_V_un[i,t-6] + dmoy_tot_L_un[i,t-6] + dmoy_tot_P_un[i,t-15]+ dmoy_tot_V_un[i,t-5] + dmoy_tot_L_un[i,t-5]+ dmoy_tot_P_un[i,t-14] +dmoy_tot_V_un[i,t-4] + dmoy_tot_L_un[i,t-4]+ dmoy_tot_P_un[i,t-13])
		ratio_wild_deux[i,t] = (dmoy_wild_V_deux[i,t-6] + dmoy_wild_L_deux[i,t-6]+ dmoy_wild_P_deux[i,t-15] + dmoy_wild_V_deux[i,t-5] + dmoy_wild_L_deux[i,t-5]+ dmoy_wild_P_deux[i,t-14] + dmoy_wild_V_deux[i,t-4] + dmoy_wild_L_deux[i,t-4] + dmoy_wild_P_deux[i,t-13]) / (dmoy_tot_V_deux[i,t-6] + dmoy_tot_L_deux[i,t-6] + dmoy_tot_P_deux[i,t-15]+ dmoy_tot_V_deux[i,t-5] + dmoy_tot_L_deux[i,t-5]+ dmoy_tot_P_deux[i,t-14] +dmoy_tot_V_deux[i,t-4] + dmoy_tot_L_deux[i,t-4]+ dmoy_tot_P_deux[i,t-13])
		ratio_wild_trois[i,t] = (dmoy_wild_V_trois[i,t-6] + dmoy_wild_L_trois[i,t-6]+ dmoy_wild_P_trois[i,t-15] + dmoy_wild_V_trois[i,t-5] + dmoy_wild_L_trois[i,t-5]+ dmoy_wild_P_trois[i,t-14] + dmoy_wild_V_trois[i,t-4] + dmoy_wild_L_trois[i,t-4] + dmoy_wild_P_trois[i,t-13]) / (dmoy_tot_V_trois[i,t-6] + dmoy_tot_L_trois[i,t-6] + dmoy_tot_P_trois[i,t-15]+ dmoy_tot_V_trois[i,t-5] + dmoy_tot_L_trois[i,t-5]+ dmoy_tot_P_trois[i,t-14] +dmoy_tot_V_trois[i,t-4] + dmoy_tot_L_trois[i,t-4]+ dmoy_tot_P_trois[i,t-13])
	}
}


for (t in 1:6){
	for (i in 1:5000){ 
		
		N_langeac_un[i,t]=p_langeac_inits_un[i,t]* (N_vichy_inits_un[i,t]-C_up[t]-p_reach_V_un[i] * C_dwn[t])
		N_langeac_deux[i,t]=p_langeac_inits_deux[i,t]* (N_vichy_inits_deux[i,t]-C_up[t]-p_reach_V_deux[i] * C_dwn[t])
		N_langeac_trois[i,t]=p_langeac_inits_trois[i,t]* (N_vichy_inits_trois[i,t]-C_up[t]-p_reach_V_trois[i] * C_dwn[t])
		
		S_vichy_un[i,t]= N_vichy_inits_un[i,t]-N_langeac_un[i,t]-C_up[t]-p_reach_V_un[i] * C_dwn[t]
		S_vichy_deux[i,t]= N_vichy_inits_deux[i,t]-N_langeac_deux[i,t]-C_up[t]-p_reach_V_deux[i] * C_dwn[t]
		S_vichy_trois[i,t]= N_vichy_inits_trois[i,t]-N_langeac_trois[i,t]-C_up[t]-p_reach_V_trois[i] * C_dwn[t]
		
		S_langeac_un[i,t]= N_langeac_un[i,t]
		S_langeac_deux[i,t]= N_langeac_deux[i,t]
		S_langeac_trois[i,t]= N_langeac_trois[i,t]
				
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
	}
}



for (t in 7:7){
	
	
	for (i in 1:5000){
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
		
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * 1  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * 1  ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * 1  ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]= N_langeac_un[i,t]
		S_langeac_deux[i,t]= N_langeac_deux[i,t]
		S_langeac_trois[i,t]= N_langeac_trois[i,t]
				
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
	}
}


for (t in 8:11){
	
	
	for (i in 1:5000){
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
		
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]= N_langeac_un[i,t]
		S_langeac_deux[i,t]= N_langeac_deux[i,t]
		S_langeac_trois[i,t]= N_langeac_trois[i,t]
				
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
				
	}
}

for (t in 12:14){
	for (i in 1:5000){
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
				
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] = 0
		ratio_juv_prod_P_deux[i,t] = 0
		ratio_juv_prod_P_trois[i,t] = 0
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
						
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
		
	}
	
}




for (t in 15:15){
	for (i in 1:5000){
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] = 0
		ratio_juv_prod_P_deux[i,t] = 0
		ratio_juv_prod_P_trois[i,t] = 0
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
				
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
	
}


for (t in 16:16){
	for (i in 1:5000){
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3] 	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] 
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] 
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
				
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}


for (t in 17:17){	
	for (i in 1:5000){
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] 	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
				
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
				
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
					
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}

for (t in 18:21){
	for (i in 1:5000){	
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
				
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
				
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
				
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		#juv_tot_vichy[i,t] = (1/3) * juv_vichy[i,t-3] + (1/3) * juv_vichy[i,t-4] + (1/3) * juv_vichy[i,t-5] 
		#juv_tot_langeac[i,t] = (1/3) * juv_langeac[i,t-3] + (1/3) * juv_langeac[i,t-4] + (1/3) * juv_langeac[i,t-5] 
		#juv_tot_poutes[i,t] = (1/3) * juv_poutes[i,t-3] + (1/3) * juv_poutes[i,t-4] + (1/3) * juv_poutes[i,t-5]	
		
		#juv_tot_system[i,t] = juv_tot_vichy[i,t]+juv_tot_langeac[i,t] +juv_tot_poutes[i,t]
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )

		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
				
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
				
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}



for (t in 22:24){
	for (i in 1:5000){	
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}


for (t in 25:27){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
				
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
				
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}




for (t in 28:31){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=max(p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		N_langeac_deux[i,t]=max(p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		N_langeac_trois[i,t]=max(p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		#N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		#N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		#N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		#N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		#N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		#N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
				
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}



for (t in 32:34){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=max(p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		N_langeac_deux[i,t]=max(p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		N_langeac_trois[i,t]=max(p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}



for (t in 35:36){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=max(p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		N_langeac_deux[i,t]=max(p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		N_langeac_trois[i,t]=max(p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}


for (t in 37:T){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
				
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
				
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		temp_un=p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t])
		temp_deux=p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t])
		temp_trois=p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t])
		N_langeac_un[i,t]=max(temp_un,1)
		N_langeac_deux[i,t]=max(temp_deux,1)
		N_langeac_trois[i,t]=max(temp_trois,1)
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
	}
}


under_10_vichy_un=array(0,dim=c(8000,20))
under_10_vichy_deux=array(0,dim=c(8000,20))
under_10_vichy_trois=array(0,dim=c(8000,20))

under_50_vichy_un=array(0,dim=c(8000,20))
under_50_vichy_deux=array(0,dim=c(8000,20))
under_50_vichy_trois=array(0,dim=c(8000,20))

under_100_vichy_un=array(0,dim=c(8000,20))
under_100_vichy_deux=array(0,dim=c(8000,20))
under_100_vichy_trois=array(0,dim=c(8000,20))

under_250_vichy_un=array(0,dim=c(8000,20))
under_250_vichy_deux=array(0,dim=c(8000,20))
under_250_vichy_trois=array(0,dim=c(8000,20))

under_500_vichy_un=array(0,dim=c(8000,20))
under_500_vichy_deux=array(0,dim=c(8000,20))
under_500_vichy_trois=array(0,dim=c(8000,20))


for (t in 24:43){
	
	for (i in 1:5000){
		if(N_vichy_real_un[i,t] < 10){under_10_vichy_un[i,t-23]=1} 
		if(N_vichy_real_deux[i,t] < 10){under_10_vichy_deux[i,t-23]=1} 
		if(N_vichy_real_trois[i,t] < 10){under_10_vichy_trois[i,t-23]=1} 
		
		if(N_vichy_real_un[i,t] < 50){under_50_vichy_un[i,t-23]=1}
		if(N_vichy_real_deux[i,t] < 50){under_50_vichy_deux[i,t-23]=1}
		if(N_vichy_real_trois[i,t] < 50){under_50_vichy_trois[i,t-23]=1}
		
		if(N_vichy_real_un[i,t] < 100){under_100_vichy_un[i,t-23]=1}
		if(N_vichy_real_deux[i,t] < 100){under_100_vichy_deux[i,t-23]=1}
		if(N_vichy_real_trois[i,t] < 100){under_100_vichy_trois[i,t-23]=1}
		
		if(N_vichy_real_un[i,t] < 250){under_250_vichy_un[i,t-23]=1}
		if(N_vichy_real_deux[i,t] < 250){under_250_vichy_deux[i,t-23]=1}
		if(N_vichy_real_trois[i,t] < 250){under_250_vichy_trois[i,t-23]=1}
		
		if(N_vichy_real_un[i,t] < 500){under_500_vichy_un[i,t-23]=1}
		if(N_vichy_real_deux[i,t] < 500){under_500_vichy_deux[i,t-23]=1}
		if(N_vichy_real_trois[i,t] < 500){under_500_vichy_trois[i,t-23]=1}
		
	}
}


p_under_10_vichy_un=rep(0,20)
p_under_10_vichy_deux=rep(0,20)
p_under_10_vichy_trois=rep(0,20)

p_under_50_vichy_un=rep(0,20)
p_under_50_vichy_deux=rep(0,20)
p_under_50_vichy_trois=rep(0,20)

p_under_100_vichy_un=rep(0,20)
p_under_100_vichy_deux=rep(0,20)
p_under_100_vichy_trois=rep(0,20)

p_under_250_vichy_un=rep(0,20)
p_under_250_vichy_deux=rep(0,20)
p_under_250_vichy_trois=rep(0,20)

p_under_500_vichy_un=rep(0,20)
p_under_500_vichy_deux=rep(0,20)
p_under_500_vichy_trois=rep(0,20)



for (t in 1:20){
	p_under_10_vichy_un[t]=mean(under_10_vichy_un[,t])
	p_under_10_vichy_deux[t]=mean(under_10_vichy_deux[,t])
	p_under_10_vichy_trois[t]=mean(under_10_vichy_trois[,t])
	
	p_under_50_vichy_un[t]=mean(under_50_vichy_un[,t])
	p_under_50_vichy_deux[t]=mean(under_50_vichy_deux[,t])
	p_under_50_vichy_trois[t]=mean(under_50_vichy_trois[,t])
	
	p_under_100_vichy_un[t]=mean(under_100_vichy_un[,t])
	p_under_100_vichy_deux[t]=mean(under_100_vichy_deux[,t])
	p_under_100_vichy_trois[t]=mean(under_100_vichy_trois[,t])
	
	p_under_250_vichy_un[t]=mean(under_250_vichy_un[,t])
	p_under_250_vichy_deux[t]=mean(under_250_vichy_deux[,t])
	p_under_250_vichy_trois[t]=mean(under_250_vichy_trois[,t])
	
	p_under_500_vichy_un[t]=mean(under_500_vichy_un[,t])
	p_under_500_vichy_deux[t]=mean(under_500_vichy_deux[,t])
	p_under_500_vichy_trois[t]=mean(under_500_vichy_trois[,t])
	
	
}


#commande ML enregistre les objets dans RDATA pour les charger ensuite
save.image(file = "C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/2014.10.14_SimuSsDevAnalRetro.RData")#file="C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/wspace.RData")
@

<< Init_AnalyseRetroLoad, echo=FALSE, eval=TRUE,results=hide >>=
setwd("C:/Users/LOGRAMI/workspace/ModeleDynamiquePop")
un<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/2014_05_30/" #Modèle Guillaume 2014.05.30
deux<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/2014_09/SurfErrSeul/"#SurfErrSeul
trois<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/2014_09/"#SurfERR+SurfDev
imgwd<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_05_30/"
imgwddeux<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_09_26SurfERR+SurfDev/"
imgwdtrois<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_09_26SurfERR+SurfDev/"



library(lattice)
library(coda)
library(boot)
require(stringr)

T=39

load("C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/2014.10.13_SimuSsDevAnalRetro.RData")

#====================================
# CHAP : Figure : spawners_reels
#====================================

S_vichy_real_un=read.coda(str_c(un,"simulation/S_vichy_realCODAchain1.txt"),str_c(un,"simulation/S_vichy_realCODAindex.txt"))
S_vichy_real_deux=read.coda(str_c(deux,"simulation/S_vichy_realCODAchain1.txt"),str_c(deux,"simulation/S_vichy_realCODAindex.txt"))
S_vichy_real_trois=read.coda(str_c(trois,"simulation/S_vichy_realCODAchain1.txt"),str_c(trois,"simulation/S_vichy_realCODAindex.txt"))

S_langeac_real_un=read.coda(str_c(un,"simulation/S_langeac_realCODAchain1.txt"),str_c(un,"simulation/S_langeac_realCODAindex.txt"))
S_langeac_real_deux=read.coda(str_c(deux,"simulation/S_langeac_realCODAchain1.txt"),str_c(deux,"simulation/S_langeac_realCODAindex.txt"))
S_langeac_real_trois=read.coda(str_c(trois,"simulation/S_langeac_realCODAchain1.txt"),str_c(trois,"simulation/S_langeac_realCODAindex.txt"))

S_vichy_q_un=array(0,dim=c(T,5))
S_vichy_q_deux=array(0,dim=c(T,5))
S_vichy_q_trois=array(0,dim=c(T,5))

S_langeac_q_un=array(0,dim=c(T,5))
S_langeac_q_deux=array(0,dim=c(T,5))
S_langeac_q_trois=array(0,dim=c(T,5))

S_poutes_counter=c(0,0,
		0,0,0,0,0,
		0,0,0,0,10,
		43,110,21,4,3,
		11,9,23,6,67,
		35,31,130,112,53,
		40,154,89,74,153,
		53,39,14,26,118,59,45)

for (i in 3:T){
	S_vichy_q_un[i,]=quantile(S_vichy_real_un[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	S_vichy_q_deux[i,]=quantile(S_vichy_real_deux[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	S_vichy_q_trois[i,]=quantile(S_vichy_real_trois[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	
	S_langeac_q_un[i,]=quantile(S_langeac_real_un[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	S_langeac_q_deux[i,]=quantile(S_langeac_real_deux[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	S_langeac_q_trois[i,]=quantile(S_langeac_real_trois[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	
}


#---------------------------
#Figure_un : Graph with all years
#---------------------------
png(file=str_c(imgwd,"simulation/spawners_reels_un.png"),width=800, height=800, units = "px",type="cairo")
par(mfrow=c(3,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,6000),ylab=expression(italic(Spawners)),main="Vichy-Langeac",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000),labels=c(0,1000,2000,3000,4000,5000,6000),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")

text(T,6000,labels=expression(italic("a.")),cex=2)


for(i in 3:T){
	#whiskers
	#95%
	segments(i-0.15,S_vichy_q_un[i,5],i+0.15,S_vichy_q_un[i,5])
	segments(i,S_vichy_q_un[i,4],i,S_vichy_q_un[i,5])
	#5%
	segments(i-0.15,S_vichy_q_un[i,1],i+0.15,S_vichy_q_un[i,1])
	segments(i,S_vichy_q_un[i,2],i,S_vichy_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(S_vichy_q_un[i,2],S_vichy_q_un[i,2],S_vichy_q_un[i,4],S_vichy_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,S_vichy_q_un[i,3],i+0.3,S_vichy_q_un[i,3])
}


#####################
#####################

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,1200),ylab=expression(italic(Spawners)),main="Langeac-Poutes",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,300,600,900,1200),labels=c(0,300,600,900,1200),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")


text(T,1200,labels=expression(italic("b.")),cex=2)



for(i in 3:T){
	#whiskers
	#95%
	segments(i-0.15,S_langeac_q_un[i,5],i+0.15,S_langeac_q_un[i,5])
	segments(i,S_langeac_q_un[i,4],i,S_langeac_q_un[i,5])
	#5%
	segments(i-0.15,S_langeac_q_un[i,1],i+0.15,S_langeac_q_un[i,1])
	segments(i,S_langeac_q_un[i,2],i,S_langeac_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(S_langeac_q_un[i,2],S_langeac_q_un[i,2],S_langeac_q_un[i,4],S_langeac_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,S_langeac_q_un[i,3],i+0.3,S_langeac_q_un[i,3])
}

#####################
#####################


plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,200),ylab=expression(italic(Spawners)),main="Amont Poutes",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,100,200),labels=c(0,100,200),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")


text(T,200,labels=expression(italic("c.")),cex=2)

points(x=seq(12,T,1),y=S_poutes_counter[12:T],pch=16)
abline(v=11.5,lty=2)
text(4,160,paste( "Amont Poutes\n inaccessible"))


dev.off()

#---------------------------
#Figure_un : Graph with all years
#---------------------------
png(file=str_c(imgwddeux,"simulation/spawners_reels_deux.png"),width=800, height=800, units = "px",type="cairo")
par(mfrow=c(3,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,6000),ylab=expression(italic(Spawners)),main="Vichy-Langeac",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000),labels=c(0,1000,2000,3000,4000,5000,6000),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")

text(T,6000,labels=expression(italic("a.")),cex=2)


for(i in 3:T){
	#whiskers
	#95%
	segments(i-0.15,S_vichy_q_deux[i,5],i+0.15,S_vichy_q_deux[i,5])
	segments(i,S_vichy_q_deux[i,4],i,S_vichy_q_deux[i,5])
	#5%
	segments(i-0.15,S_vichy_q_deux[i,1],i+0.15,S_vichy_q_deux[i,1])
	segments(i,S_vichy_q_deux[i,2],i,S_vichy_q_deux[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(S_vichy_q_deux[i,2],S_vichy_q_deux[i,2],S_vichy_q_deux[i,4],S_vichy_q_deux[i,4]),col="light grey")
	#median
	segments(i-0.3,S_vichy_q_deux[i,3],i+0.3,S_vichy_q_deux[i,3])
}


#####################
#####################

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,1200),ylab=expression(italic(Spawners)),main="Langeac-Poutes",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,300,600,900,1200),labels=c(0,300,600,900,1200),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")


text(T,1200,labels=expression(italic("b.")),cex=2)



for(i in 3:T){
	#whiskers
	#95%
	segments(i-0.15,S_langeac_q_deux[i,5],i+0.15,S_langeac_q_deux[i,5])
	segments(i,S_langeac_q_deux[i,4],i,S_langeac_q_deux[i,5])
	#5%
	segments(i-0.15,S_langeac_q_deux[i,1],i+0.15,S_langeac_q_deux[i,1])
	segments(i,S_langeac_q_deux[i,2],i,S_langeac_q_deux[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(S_langeac_q_deux[i,2],S_langeac_q_deux[i,2],S_langeac_q_deux[i,4],S_langeac_q_deux[i,4]),col="light grey")
	#median
	segments(i-0.3,S_langeac_q_deux[i,3],i+0.3,S_langeac_q_deux[i,3])
}

#####################
#####################


plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,200),ylab=expression(italic(Spawners)),main="Amont Poutes",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,100,200),labels=c(0,100,200),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")


text(T,200,labels=expression(italic("c.")),cex=2)

points(x=seq(12,T,1),y=S_poutes_counter[12:T],pch=16)
abline(v=11.5,lty=2)
text(4,160,paste( "Amont Poutes\n inaccessible"))


dev.off()

#---------------------------
#Figure_trois : Graph with all years
#---------------------------
png(file=str_c(imgwdtrois,"simulation/spawners_reels_trois.png"),width=800, height=800, units = "px",type="cairo")
par(mfrow=c(3,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,6000),ylab=expression(italic(Spawners)),main="Vichy-Langeac",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000),labels=c(0,1000,2000,3000,4000,5000,6000),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")

text(T,6000,labels=expression(italic("a.")),cex=2)


for(i in 3:T){
	#whiskers
	#95%
	segments(i-0.15,S_vichy_q_trois[i,5],i+0.15,S_vichy_q_trois[i,5])
	segments(i,S_vichy_q_trois[i,4],i,S_vichy_q_trois[i,5])
	#5%
	segments(i-0.15,S_vichy_q_trois[i,1],i+0.15,S_vichy_q_trois[i,1])
	segments(i,S_vichy_q_trois[i,2],i,S_vichy_q_trois[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(S_vichy_q_trois[i,2],S_vichy_q_trois[i,2],S_vichy_q_trois[i,4],S_vichy_q_trois[i,4]),col="light grey")
	#median
	segments(i-0.3,S_vichy_q_trois[i,3],i+0.3,S_vichy_q_trois[i,3])
}


#####################
#####################

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,1200),ylab=expression(italic(Spawners)),main="Langeac-Poutes",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,300,600,900,1200),labels=c(0,300,600,900,1200),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")


text(T,1200,labels=expression(italic("b.")),cex=2)



for(i in 3:T){
	#whiskers
	#95%
	segments(i-0.15,S_langeac_q_trois[i,5],i+0.15,S_langeac_q_trois[i,5])
	segments(i,S_langeac_q_trois[i,4],i,S_langeac_q_trois[i,5])
	#5%
	segments(i-0.15,S_langeac_q_trois[i,1],i+0.15,S_langeac_q_trois[i,1])
	segments(i,S_langeac_q_trois[i,2],i,S_langeac_q_trois[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(S_langeac_q_trois[i,2],S_langeac_q_trois[i,2],S_langeac_q_trois[i,4],S_langeac_q_trois[i,4]),col="light grey")
	#median
	segments(i-0.3,S_langeac_q_trois[i,3],i+0.3,S_langeac_q_trois[i,3])
}

#####################
#####################


plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,200),ylab=expression(italic(Spawners)),main="Amont Poutes",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,100,200),labels=c(0,100,200),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.5,las = 1,col = "black")


text(T,200,labels=expression(italic("c.")),cex=2)

points(x=seq(12,T,1),y=S_poutes_counter[12:T],pch=16)
abline(v=11.5,lty=2)
text(4,160,paste( "Amont Poutes\n inaccessible"))


dev.off()

@
\section{Analyse rétrospective - sans les repeuplements}

\begin{figure}[h!]
          \centering
          \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwddeux}simulation/spawners_reels_deux.png}
                  \caption{Spawners reels modèle SurfErrSeul}
                  \label{Spawners_reels_deux}
         \end{subfigure}%         
        ~%~%\qquad
        \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwdtrois}simulation/spawners_reels_trois.png}
                  \caption{Spawners reels modèle SurfErr+SurfDev}
                  \label{Spawners_reels_trois}
        \end{subfigure}          
        \hfill
        \begin{subfigure}{0.59\textwidth}
                  \centering
                  \includegraphics{\Sexpr{imgwd}simulation/spawners_reels_un.png}
                  \caption{Spawners reels modèle GuillaumeMaJ}
                  \label{Spawners_reels_un}
          \end{subfigure}%    
  \caption[Comparaison des 3 modèles : Géniteurs réels par secteur]{Comparaison
  des 3 modèles :
  Géniteurs réels par secteur. Les
  boxplots indiquent les quantiles à 2.5$^th$, 25$^th$,
  75$^th$ et 97.5$^th$.}
  \label{Spawners_reels}
  \end{figure}

<<RetourVersLeFutur,echo=FALSE, eval=TRUE,results=hide>>=
N_vichy_real_un=read.coda(str_c(un,"simulation/N_vichy_realCODAchain1.txt"),str_c(un,"simulation/N_vichy_realCODAindex.txt"))
N_vichy_real_deux=read.coda(str_c(deux,"simulation/N_vichy_realCODAchain1.txt"),str_c(deux,"simulation/N_vichy_realCODAindex.txt"))
N_vichy_real_trois=read.coda(str_c(trois,"simulation/N_vichy_realCODAchain1.txt"),str_c(trois,"simulation/N_vichy_realCODAindex.txt"))
N_vichy_inits_un=read.coda(str_c(un,"N_VichyCODAchain1.txt"),str_c(un,"N_VichyCODAindex.txt"))
N_vichy_inits_deux=read.coda(str_c(deux,"N_VichyCODAchain1.txt"),str_c(deux,"N_VichyCODAindex.txt"))
N_vichy_inits_trois=read.coda(str_c(trois,"N_VichyCODAchain1.txt"),str_c(trois,"N_VichyCODAindex.txt"))
#taking coda of the first 6 years of p_langeac
p_langeac_inits_un=read.coda(str_c(un,"p_langeacCODAchain1.txt"),str_c(un,"p_langeacCODAindex.txt"))
p_langeac_inits_deux=read.coda(str_c(deux,"p_langeacCODAchain1.txt"),str_c(deux,"p_langeacCODAindex.txt"))
p_langeac_inits_trois=read.coda(str_c(trois,"p_langeacCODAchain1.txt"),str_c(trois,"p_langeacCODAindex.txt"))
p_reach_V_un=read.coda(str_c(un,"p_reach_VCODAchain1.txt"),str_c(un,"p_reach_VCODAindex.txt"))
p_reach_V_deux=read.coda(str_c(deux,"p_reach_VCODAchain1.txt"),str_c(deux,"p_reach_VCODAindex.txt"))
p_reach_V_trois=read.coda(str_c(trois,"p_reach_VCODAchain1.txt"),str_c(trois,"p_reach_VCODAindex.txt"))

N_vichy_real_q_un=array(NA,dim=c((T+20-15),5))
N_vichy_q_un=array(NA,dim=c(T,5))
N_vichy_real_q_deux=array(NA,dim=c((T+20-15),5))
N_vichy_q_deux=array(NA,dim=c(T,5))
N_vichy_real_q_trois=array(NA,dim=c((T+20-15),5))
N_vichy_q_trois=array(NA,dim=c(T,5))

S_vichy_un=array(0,dim=c(5000,T))
S_vichy_deux=array(0,dim=c(5000,T))
S_vichy_trois=array(0,dim=c(5000,T))

S_langeac_un=array(0,dim=c(5000,T))
S_langeac_deux=array(0,dim=c(5000,T))
S_langeac_trois=array(0,dim=c(5000,T))

S_poutes_un=array(0,dim=c(5000,T))
S_poutes_deux=array(0,dim=c(5000,T))
S_poutes_trois=array(0,dim=c(5000,T))

N_langeac_un=array(0,dim=c(5000,T))
N_langeac_deux=array(0,dim=c(5000,T))
N_langeac_trois=array(0,dim=c(5000,T))

N_poutes_un=array(0,dim=c(5000,T))
N_poutes_deux=array(0,dim=c(5000,T))
N_poutes_trois=array(0,dim=c(5000,T))

d_moy_vichy_un=array(0,dim=c(5000,T+1))
d_moy_vichy_deux=array(0,dim=c(5000,T+1))
d_moy_vichy_trois=array(0,dim=c(5000,T+1))

d_moy_langeac_un=array(0,dim=c(5000,T+1))
d_moy_langeac_deux=array(0,dim=c(5000,T+1))
d_moy_langeac_trois=array(0,dim=c(5000,T+1))

d_moy_poutes_un=array(0,dim=c(5000,T+1))
d_moy_poutes_deux=array(0,dim=c(5000,T+1))
d_moy_poutes_trois=array(0,dim=c(5000,T+1))

juv_vichy_un=array(0,dim=c(5000,T+1))
juv_vichy_deux=array(0,dim=c(5000,T+1))
juv_vichy_trois=array(0,dim=c(5000,T+1))

juv_langeac_un=array(0,dim=c(5000,T+1))
juv_langeac_deux=array(0,dim=c(5000,T+1))
juv_langeac_trois=array(0,dim=c(5000,T+1))

juv_poutes_un=array(0,dim=c(5000,T+1))
juv_poutes_deux=array(0,dim=c(5000,T+1))
juv_poutes_trois=array(0,dim=c(5000,T+1))

juv_tot_vichy_un=array(0,dim=c(5000,T+1))
juv_tot_vichy_deux=array(0,dim=c(5000,T+1))
juv_tot_vichy_trois=array(0,dim=c(5000,T+1))

juv_tot_langeac_un=array(0,dim=c(5000,T+1))
juv_tot_langeac_deux=array(0,dim=c(5000,T+1))
juv_tot_langeac_trois=array(0,dim=c(5000,T+1))

juv_tot_poutes_un=array(0,dim=c(5000,T+1))
juv_tot_poutes_deux=array(0,dim=c(5000,T+1))
juv_tot_poutes_trois=array(0,dim=c(5000,T+1))

juv_tot_system_un=array(0,dim=c(5000,T+1))
juv_tot_system_deux=array(0,dim=c(5000,T+1))
juv_tot_system_trois=array(0,dim=c(5000,T+1))

ratio_juv_prod_V_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_V_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_V_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_prod_L_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_L_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_L_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_prod_P_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_P_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_prod_P_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_V_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_V_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_V_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_L_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_L_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_L_trois=array(rep(0,T*5000),dim=c(5000,T))

ratio_juv_P_un=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_P_deux=array(rep(0,T*5000),dim=c(5000,T))
ratio_juv_P_trois=array(rep(0,T*5000),dim=c(5000,T))

for (t in 1:6){
	for (i in 1:5000){ 
		
		N_langeac_un[i,t]=p_langeac_inits_un[i,t]* (N_vichy_inits_un[i,t]-C_up[t]-p_reach_V_un[i] * C_dwn[t])
		N_langeac_deux[i,t]=p_langeac_inits_deux[i,t]* (N_vichy_inits_deux[i,t]-C_up[t]-p_reach_V_deux[i] * C_dwn[t])
		N_langeac_trois[i,t]=p_langeac_inits_trois[i,t]* (N_vichy_inits_trois[i,t]-C_up[t]-p_reach_V_trois[i] * C_dwn[t])
		
		S_vichy_un[i,t]= N_vichy_inits_un[i,t]-N_langeac_un[i,t]-C_up[t]-p_reach_V_un[i] * C_dwn[t]
		S_vichy_deux[i,t]= N_vichy_inits_deux[i,t]-N_langeac_deux[i,t]-C_up[t]-p_reach_V_deux[i] * C_dwn[t]
		S_vichy_trois[i,t]= N_vichy_inits_trois[i,t]-N_langeac_trois[i,t]-C_up[t]-p_reach_V_trois[i] * C_dwn[t]
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
				
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
	}
}

for (t in 7:7){
	for (i in 1:5000){
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
		
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * 1  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * 1  ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * 1  ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]= N_langeac_un[i,t]
		S_langeac_deux[i,t]= N_langeac_deux[i,t]
		S_langeac_trois[i,t]= N_langeac_trois[i,t]
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
	}
}

save.image(file="C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/sept.rdata")
for (t in 8:11){
	
	
	for (i in 1:5000){
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
		
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]= N_langeac_un[i,t]
		S_langeac_deux[i,t]= N_langeac_deux[i,t]
		S_langeac_trois[i,t]= N_langeac_trois[i,t]
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
	}
}
save.image(file = "C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/douze.rdata")
load("C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/douze.rdata")
for (t in 12:14){
	for (i in 1:5000){
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
		
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] = 0
		ratio_juv_prod_P_deux[i,t] = 0
		ratio_juv_prod_P_trois[i,t] = 0
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
		
	}
	
}


for (t in 15:15){
	for (i in 1:5000){
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] 
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] 
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t] 
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  juv_tot_langeac_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  juv_tot_langeac_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  juv_tot_langeac_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] = 0
		ratio_juv_prod_P_deux[i,t] = 0
		ratio_juv_prod_P_trois[i,t] = 0
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
	
}


for (t in 16:16){
	for (i in 1:5000){
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3] 	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] 
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] 
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_prod_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t]	
		ratio_juv_prod_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_prod_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}


for (t in 17:17){	
	for (i in 1:5000){
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] 	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}

for (t in 18:21){
	for (i in 1:5000){	
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		#juv_tot_vichy[i,t] = (1/3) * juv_vichy[i,t-3] + (1/3) * juv_vichy[i,t-4] + (1/3) * juv_vichy[i,t-5] 
		#juv_tot_langeac[i,t] = (1/3) * juv_langeac[i,t-3] + (1/3) * juv_langeac[i,t-4] + (1/3) * juv_langeac[i,t-5] 
		#juv_tot_poutes[i,t] = (1/3) * juv_poutes[i,t-3] + (1/3) * juv_poutes[i,t-4] + (1/3) * juv_poutes[i,t-5]	
		
		#juv_tot_system[i,t] = juv_tot_vichy[i,t]+juv_tot_langeac[i,t] +juv_tot_poutes[i,t]
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}



for (t in 22:24){
	for (i in 1:5000){	
		
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}


for (t in 25:27){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}




for (t in 28:31){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=max(p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		N_langeac_deux[i,t]=max(p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		N_langeac_trois[i,t]=max(p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		#N_langeac_un[i,t]=p_langeac_un[i,t]* max( N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)	
		#N_langeac_deux[i,t]=p_langeac_deux[i,t]* max( N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)	
		#N_langeac_trois[i,t]=p_langeac_trois[i,t]* max( N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)	
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		#N_poutes_un[i,t]=p_poutes_un[i,t]*N_langeac_un[i,t]	
		#N_poutes_deux[i,t]=p_poutes_deux[i,t]*N_langeac_deux[i,t]
		#N_poutes_trois[i,t]=p_poutes_trois[i,t]*N_langeac_trois[i,t]
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}



for (t in 32:34){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=max(p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		N_langeac_deux[i,t]=max(p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		N_langeac_trois[i,t]=max(p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}



for (t in 35:36){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		N_langeac_un[i,t]=max(p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		N_langeac_deux[i,t]=max(p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		N_langeac_trois[i,t]=max(p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
		
		d_moy_vichy_un[i,t+1]= exp((log(((S_vichy_un[i,t]/S_juv_JP_anc[1]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_vichy_un[i,t]/S_juv_JP_anc[1]) )) * exp(nu_wild_un[i,1]))+ res_wild_vichy_un[i,t] ))
		d_moy_vichy_deux[i,t+1]= exp((log(((S_vichy_deux[i,t]/S_juv_JP[1,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_vichy_deux[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_deux[i,1]))+ res_wild_vichy_deux[i,t] ))
		d_moy_vichy_trois[i,t+1]= exp((log(((S_vichy_trois[i,t]/S_juv_JP[1,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_vichy_trois[i,t]/S_juv_JP[1,t]) )) * exp(nu_wild_trois[i,1]))+ res_wild_vichy_trois[i,t] ))
		
		d_moy_langeac_un[i,t+1]= exp((log(((S_langeac_un[i,t]/S_juv_JP_anc[2]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_langeac_un[i,t]/S_juv_JP_anc[2]) )) * exp(nu_wild_un[i,2]))+ res_wild_langeac_un[i,t] ))
		d_moy_langeac_deux[i,t+1]= exp((log(((S_langeac_deux[i,t]/S_juv_JP[2,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_langeac_deux[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_deux[i,2]))+ res_wild_langeac_deux[i,t] ))
		d_moy_langeac_trois[i,t+1]= exp((log(((S_langeac_trois[i,t]/S_juv_JP[2,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_langeac_trois[i,t]/S_juv_JP[2,t]) )) * exp(nu_wild_trois[i,2]))+ res_wild_langeac_trois[i,t] ))
		
		d_moy_poutes_un[i,t+1]= exp((log(((S_poutes_un[i,t]/S_juv_JP_anc[3]) / (alpha_dd_un[i] + beta_dd_un[i] * (S_poutes_un[i,t]/S_juv_JP_anc[3]) )) * exp(nu_wild_un[i,3]))+ res_wild_poutes_un[i,t-11] ))
		d_moy_poutes_deux[i,t+1]= exp((log(((S_poutes_deux[i,t]/S_juv_JP[3,t]) / (alpha_dd_deux[i] + beta_dd_deux[i] * (S_poutes_deux[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_deux[i,3]))+ res_wild_poutes_deux[i,t-11] ))
		d_moy_poutes_trois[i,t+1]= exp((log(((S_poutes_trois[i,t]/S_juv_JP[3,t]) / (alpha_dd_trois[i] + beta_dd_trois[i] * (S_poutes_trois[i,t]/S_juv_JP[3,t]) )) * exp(nu_wild_trois[i,3]))+ res_wild_poutes_trois[i,t-11] ))
		
		juv_vichy_un[i,t+1]=d_moy_vichy_un[i,t+1]*S_juv_JP_anc[1]
		juv_vichy_deux[i,t+1]=d_moy_vichy_deux[i,t+1]*S_juv_JP[1,t]
		juv_vichy_trois[i,t+1]=d_moy_vichy_trois[i,t+1]*S_juv_JP[1,t]
		
		juv_langeac_un[i,t+1]=d_moy_langeac_un[i,t+1]*S_juv_JP_anc[2]
		juv_langeac_deux[i,t+1]=d_moy_langeac_deux[i,t+1]*S_juv_JP[2,t]
		juv_langeac_trois[i,t+1]=d_moy_langeac_trois[i,t+1]*S_juv_JP[2,t]
		
		juv_poutes_un[i,t+1]=d_moy_poutes_un[i,t+1]*S_juv_JP_anc[3]
		juv_poutes_deux[i,t+1]=d_moy_poutes_deux[i,t+1]*S_juv_JP[3,t]
		juv_poutes_trois[i,t+1]=d_moy_poutes_trois[i,t+1]*S_juv_JP[3,t]	
	}
}


for (t in 37:T){
	for (i in 1:5000){	
		juv_tot_vichy_un[i,t] = (1/3) * juv_vichy_un[i,t-3] + (1/3) * juv_vichy_un[i,t-4] + (1/3) * juv_vichy_un[i,t-5]
		juv_tot_vichy_deux[i,t] = (1/3) * juv_vichy_deux[i,t-3] + (1/3) * juv_vichy_deux[i,t-4] + (1/3) * juv_vichy_deux[i,t-5] 
		juv_tot_vichy_trois[i,t] = (1/3) * juv_vichy_trois[i,t-3] + (1/3) * juv_vichy_trois[i,t-4] + (1/3) * juv_vichy_trois[i,t-5] 
		
		juv_tot_langeac_un[i,t] = (1/3) * juv_langeac_un[i,t-3] + (1/3) * juv_langeac_un[i,t-4] + (1/3) * juv_langeac_un[i,t-5]
		juv_tot_langeac_deux[i,t] = (1/3) * juv_langeac_deux[i,t-3] + (1/3) * juv_langeac_deux[i,t-4] + (1/3) * juv_langeac_deux[i,t-5]	
		juv_tot_langeac_trois[i,t] = (1/3) * juv_langeac_trois[i,t-3] + (1/3) * juv_langeac_trois[i,t-4] + (1/3) * juv_langeac_trois[i,t-5]	
		
		juv_tot_poutes_un[i,t] = (1/3) * juv_poutes_un[i,t-3]+ (1/3) * juv_poutes_un[i,t-4] + (1/3) * juv_poutes_un[i,t-5]	
		juv_tot_poutes_deux[i,t] = (1/3) * juv_poutes_deux[i,t-3] + (1/3) * juv_poutes_deux[i,t-4]+ (1/3) * juv_poutes_deux[i,t-5]
		juv_tot_poutes_trois[i,t] = (1/3) * juv_poutes_trois[i,t-3] + (1/3) * juv_poutes_trois[i,t-4]+ (1/3) * juv_poutes_trois[i,t-5]
		
		juv_tot_system_un[i,t] = juv_tot_vichy_un[i,t]+juv_tot_langeac_un[i,t] +juv_tot_poutes_un[i,t]
		juv_tot_system_deux[i,t] = juv_tot_vichy_deux[i,t]+juv_tot_langeac_deux[i,t] +juv_tot_poutes_deux[i,t]
		juv_tot_system_trois[i,t] = juv_tot_vichy_trois[i,t]+juv_tot_langeac_trois[i,t]+juv_tot_poutes_trois[i,t] 
		
		ratio_juv_V_un[i,t] =1 - ratio_juv_prod_L_un[i,t] 
		ratio_juv_V_deux[i,t] =1 - ratio_juv_prod_L_deux[i,t]	
		ratio_juv_V_trois[i,t] =1 - ratio_juv_prod_L_trois[i,t]	
		
		ratio_juv_prod_L_un[i,t] =  (juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t]) / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t]+ juv_tot_poutes_un[i,t] )
		ratio_juv_prod_L_deux[i,t] =  (juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t])/ ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t]+ juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_L_trois[i,t] =  (juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t]) / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t]+ juv_tot_poutes_trois[i,t] )
		ratio_juv_L_un[i,t]= rho_station_un[i] * (ratio_habitat_un[2]+ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_L_un[i,t]
		ratio_juv_L_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[2]+ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_L_deux[i,t]
		ratio_juv_L_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[2]+ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_L_trois[i,t]
		
		p_langeac_un[i,t]=inv.logit( logit(ratio_juv_L_un[i,t]) + adjust_p_L_un[i] + res_p_langeac_un[i,t] )
		p_langeac_deux[i,t]=inv.logit( logit(ratio_juv_L_deux[i,t]) + adjust_p_L_deux[i] + res_p_langeac_deux[i,t] )
		p_langeac_trois[i,t]=inv.logit( logit(ratio_juv_L_trois[i,t]) + adjust_p_L_trois[i] + res_p_langeac_trois[i,t] )
		
		ratio_juv_prod_P_un[i,t] =  juv_tot_poutes_un[i,t] / ( juv_tot_vichy_un[i,t] + juv_tot_langeac_un[i,t] + juv_tot_poutes_un[i,t] )
		ratio_juv_prod_P_deux[i,t] =  juv_tot_poutes_deux[i,t] / ( juv_tot_vichy_deux[i,t] + juv_tot_langeac_deux[i,t] + juv_tot_poutes_deux[i,t] )
		ratio_juv_prod_P_trois[i,t] =  juv_tot_poutes_trois[i,t] / ( juv_tot_vichy_trois[i,t] + juv_tot_langeac_trois[i,t] + juv_tot_poutes_trois[i,t] )
		ratio_juv_P_un[i,t]= rho_station_un[i] * (ratio_habitat_un[3]) + (1 -  rho_station_un[i]) * ratio_juv_prod_P_un[i,t]
		ratio_juv_P_deux[i,t]= rho_station_deux[i] * (ratio_habitat_deux[3]) + (1 -  rho_station_deux[i]) * ratio_juv_prod_P_deux[i,t]
		ratio_juv_P_trois[i,t]= rho_station_trois[i] * (ratio_habitat_trois[3]) + (1 -  rho_station_trois[i]) * ratio_juv_prod_P_trois[i,t]
		
		p_poutes_un[i,t]=inv.logit( logit(ratio_juv_P_un[i,t]) + adjust_p_P_un[i] + res_p_poutes_un[i,t-11] ) 
		p_poutes_deux[i,t]=inv.logit( logit(ratio_juv_P_deux[i,t]) + adjust_p_P_deux[i] + res_p_poutes_deux[i,t-11] ) 
		p_poutes_trois[i,t]=inv.logit( logit(ratio_juv_P_trois[i,t]) + adjust_p_P_trois[i] + res_p_poutes_trois[i,t-11] ) 
		
		N_vichy_un[i,t]=exp( log( exp(level_s_un[i] * I_surv_un[i,t-7]  ) *s_juv2ad_un[i] * juv_tot_system_un[i,t]) +res_vichy_un[i,t-6] )
		N_vichy_deux[i,t]=exp( log( exp(level_s_deux[i] * I_surv_deux[i,t-7]   ) *s_juv2ad_deux[i] * juv_tot_system_deux[i,t]) +res_vichy_deux[i,t-6] )
		N_vichy_trois[i,t]=exp( log( exp(level_s_trois[i] * I_surv_trois[i,t-7]   ) *s_juv2ad_trois[i] * juv_tot_system_trois[i,t]) +res_vichy_trois[i,t-6] )
		
		temp_un=p_langeac_un[i,t]*  N_vichy_un[i,t] - ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t])
		temp_deux=p_langeac_deux[i,t]*  N_vichy_deux[i,t] - ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t])
		temp_trois=p_langeac_trois[i,t]*  N_vichy_trois[i,t] - ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t])
		N_langeac_un[i,t]=max(temp_un,1)
		N_langeac_deux[i,t]=max(temp_deux,1)
		N_langeac_trois[i,t]=max(temp_trois,1)
		
		N_poutes_un[i,t]=max(p_poutes_un[i,t]*N_langeac_un[i,t],1)	
		N_poutes_deux[i,t]=max(p_poutes_deux[i,t]*N_langeac_deux[i,t],1)	
		N_poutes_trois[i,t]=max(p_poutes_trois[i,t]*N_langeac_trois[i,t],1)	
		
		S_vichy_un[i,t]= max(N_vichy_un[i,t]-N_langeac_un[i,t]- ratio_wild_un[i,t] *(C_up[t]+p_reach_V_un[i] * C_dwn[t]),1)
		S_vichy_deux[i,t]= max(N_vichy_deux[i,t]-N_langeac_deux[i,t]- ratio_wild_deux[i,t] *(C_up[t]+p_reach_V_deux[i] * C_dwn[t]),1)
		S_vichy_trois[i,t]= max(N_vichy_trois[i,t]-N_langeac_trois[i,t]- ratio_wild_trois[i,t] *(C_up[t]+p_reach_V_trois[i] * C_dwn[t]),1)
		
		S_langeac_un[i,t]=max( N_langeac_un[i,t]-N_poutes_un[i,t],1)
		S_langeac_deux[i,t]=max( N_langeac_deux[i,t]-N_poutes_deux[i,t],1)
		S_langeac_trois[i,t]=max( N_langeac_trois[i,t]-N_poutes_trois[i,t],1)
		
		S_poutes_un[i,t]=max(N_poutes_un[i,t],1)
		S_poutes_deux[i,t]=max(N_poutes_deux[i,t],1)
		S_poutes_trois[i,t]=max(N_poutes_trois[i,t],1)
	}
}



for (t in 1:T){
	N_vichy_q_un[t,]=quantile(N_vichy_un[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	N_vichy_q_deux[t,]=quantile(N_vichy_deux[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	N_vichy_q_trois[t,]=quantile(N_vichy_trois[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
}

#Attention é l'année 30 oé estimation des passages é Vichy car année jugée incompléte
for (t in 1:(T-T+22)){
	N_vichy_real_q_un[t,]=quantile(N_vichy_real_un[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
}
for(t in (T-T+23):(T-T+23)){
	N_vichy_real_q_un[(t+7),]=quantile(N_vichy_real_un[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
}



diff_N_vichy_un=array(0,dim=c(5000,T))
diff_N_vichy_deux=array(0,dim=c(5000,T))
diff_N_vichy_trois=array(0,dim=c(5000,T))

for (t in 7:22){
	for (i in 1:5000){
		diff_N_vichy_un[i,t]=N_vichy_real_un[i,t]-N_vichy_un[i,t] 
		diff_N_vichy_deux[i,t]=N_vichy_real_deux[i,t]-N_vichy_deux[i,t] 
		diff_N_vichy_trois[i,t]=N_vichy_real_trois[i,t]-N_vichy_trois[i,t] 
		
	}
} 

for (t in 23:(T-T+29)){
	for (i in 1:5000){
		diff_N_vichy_un[i,t]=data_vichy[t]-N_vichy_un[i,t] 
		diff_N_vichy_deux[i,t]=data_vichy[t]-N_vichy_deux[i,t] 
		diff_N_vichy_trois[i,t]=data_vichy[t]-N_vichy_trois[i,t] 
	}
} 

for (t in (T-T+30):(T-T+30)){
	for (i in 1:5000){
		diff_N_vichy_un[i,t]=N_vichy_real_un[i,(t-7)]-N_vichy_un[i,t] 
		diff_N_vichy_deux[i,t]=N_vichy_real_deux[i,(t-7)]-N_vichy_deux[i,t] 
		diff_N_vichy_trois[i,t]=N_vichy_real_trois[i,(t-7)]-N_vichy_trois[i,t] 
	}
} 

for (t in (T-T+31):T){
	for (i in 1:5000){
		diff_N_vichy_un[i,t]=data_vichy[t]-N_vichy_un[i,t] 
		diff_N_vichy_deux[i,t]=data_vichy[t]-N_vichy_deux[i,t] 
		diff_N_vichy_trois[i,t]=data_vichy[t]-N_vichy_trois[i,t] 
	}
} 


diff_N_vichy_q_un=array(0,dim=c(T,5))
diff_N_vichy_q_deux=array(0,dim=c(T,5))
diff_N_vichy_q_trois=array(0,dim=c(T,5))

for (t in 7:T){
	diff_N_vichy_q_un[t,]=quantile(diff_N_vichy_un[,t],probs=c(0.025,0.25,0.5,0.75,0.975),na.rm=TRUE,names=FALSE)
	diff_N_vichy_q_deux[t,]=quantile(diff_N_vichy_deux[,t],probs=c(0.025,0.25,0.5,0.75,0.975),na.rm=TRUE,names=FALSE)
	diff_N_vichy_q_trois[t,]=quantile(diff_N_vichy_trois[,t],probs=c(0.025,0.25,0.5,0.75,0.975),na.rm=TRUE,names=FALSE)
}



pour_stocking_vichy_un=array(0,dim=c(5000,T))

for (t in 1:T){
	for (i in 1:5000){
		pour_stocking_vichy_un[i,t]= (S_vichy_real_un[i,t]-S_vichy_un[i,t])/S_vichy_real_un[i,t]  
	}
} 

pour_stocking_vichy_q_un=array(0,dim=c(T,5))

for (i in 1:T){
	pour_stocking_vichy_q_un[i,]=quantile(pour_stocking_vichy_un[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	
}

min(pour_stocking_vichy_q)
max(pour_stocking_vichy_q)

#-----------------------------
# Graph
#-----------------------------
png(filename=str_c(imgwd,"simulation/RetourVersLeFutur.png"),width=800,height=800)

par(mfrow=c(2,2))


plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="With stocking",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")

for(i in 3:30){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_real_q_un[i,5],i+0.15,N_vichy_real_q_un[i,5])
	segments(i,N_vichy_real_q_un[i,4],i,N_vichy_real_q_un[i,5])
	#5%
	segments(i-0.15,N_vichy_real_q_un[i,1],i+0.15,N_vichy_real_q_un[i,1])
	segments(i,N_vichy_real_q_un[i,2],i,N_vichy_real_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_un[i,2],N_vichy_real_q_un[i,2],N_vichy_real_q_un[i,4],N_vichy_real_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_real_q_un[i,3],i+0.3,N_vichy_real_q_un[i,3])
}


data_vichy=c(
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,393,267,515,
		380,400,541,1238,NA,
		510,950,572,421,491,
		227,755,861,819)

points(x=seq(23,T,1),data_vichy[23:T],pch=16)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="Simulation without stocking",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")


for(i in 3:6){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_real_q_un[i,5],i+0.15,N_vichy_real_q_un[i,5])
	segments(i,N_vichy_real_q_un[i,4],i,N_vichy_real_q_un[i,5])
	#5%
	segments(i-0.15,N_vichy_real_q_un[i,1],i+0.15,N_vichy_real_q_un[i,1])
	segments(i,N_vichy_real_q_un[i,2],i,N_vichy_real_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_un[i,2],N_vichy_real_q_un[i,2],N_vichy_real_q_un[i,4],N_vichy_real_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_real_q_un[i,3],i+0.3,N_vichy_real_q_un[i,3])
}

for(i in 7:T){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_q_un[i,5],i+0.15,N_vichy_q_un[i,5])
	segments(i,N_vichy_q_un[i,4],i,N_vichy_q_un[i,5])
	#5%
	segments(i-0.15,N_vichy_q_un[i,1],i+0.15,N_vichy_q_un[i,1])
	segments(i,N_vichy_q_un[i,2],i,N_vichy_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_q_un[i,2],N_vichy_q_un[i,2],N_vichy_q_un[i,4],N_vichy_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_q_un[i,3],i+0.3,N_vichy_q_un[i,3])
}



#<<Fig_spawners_DiffWith_WithoutStocking, echo=FALSE, eval=FALSE,results=hide>>=
	
#==============================================
# CHAP : figure : ReturnsWith&withoutStocking
#==============================================
#png(filename="C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/simulation/2014.05.30/outputAllier_ReturnsDifferenceWith&withoutStocking_.png",width=800,height=800)
#par(mfrow=c(1,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(-500,1500),ylab=expression(Returns^stocking-Returns^without),main="Difference of returns in Vichy with or without stocking",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(-500,0,500,1000,1500),labels=c(-500,0,500,1000,1500),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")


points(x=c(3,4,5,6),y=c(1,1,1,1),pch=16)


for(i in 7:T){
	#whiskers
	#95%
	segments(i-0.15,diff_N_vichy_q_un[i,5],i+0.15,diff_N_vichy_q_un[i,5])
	segments(i,diff_N_vichy_q_un[i,4],i,diff_N_vichy_q_un[i,5])
	#5%
	segments(i-0.15,diff_N_vichy_q_un[i,1],i+0.15,diff_N_vichy_q_un[i,1])
	segments(i,diff_N_vichy_q_un[i,2],i,diff_N_vichy_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(diff_N_vichy_q_un[i,2],diff_N_vichy_q_un[i,2],diff_N_vichy_q_un[i,4],diff_N_vichy_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,diff_N_vichy_q_un[i,3],i+0.3,diff_N_vichy_q_un[i,3])
}

segments(1,0,38,lty=2,col="red")


#@

#<<Fig_ContributionStockingAllierPopulation, echo=FALSE,
#eval=FALSE,results=hide>>=
	
#=======================================================
# CHAP : Figure : ContributionStockingAllierPopulation
#=======================================================
#########################################################
# Graph what did stocking bring to the Allier population
#########################################################



#--------------------------
#Graph with all years
#--------------------------
#png(filename=str_c("simulation/ContributionStockingAllierPopulation_un.png"),width=800,height=800)

#par(mfrow=c(1,1))

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,1),ylab="%stocking",main="Contribution of stocking to adults returns",cex.lab = 1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,0.2,0.4,0.6,0.8,1),labels=c(0,0.2,0.4,0.6,0.8,1),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")

#text(T,15,labels=expression(italic("a.")))



for(i in 7:T){
	#whiskers
	#95%
	segments(i-0.15,pour_stocking_vichy_q_un[i,5],i+0.15,pour_stocking_vichy_q_un[i,5])
	segments(i,pour_stocking_vichy_q_un[i,4],i,pour_stocking_vichy_q_un[i,5])
	#5%
	segments(i-0.15,pour_stocking_vichy_q_un[i,1],i+0.15,pour_stocking_vichy_q_un[i,1])
	segments(i,pour_stocking_vichy_q_un[i,2],i,pour_stocking_vichy_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(pour_stocking_vichy_q_un[i,2],pour_stocking_vichy_q_un[i,2],pour_stocking_vichy_q_un[i,4],pour_stocking_vichy_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,pour_stocking_vichy_q_un[i,3],i+0.3,pour_stocking_vichy_q_un[i,3])
}


dev.off()
@



<<Fig_TotalReturns, echo=FALSE, eval=FALSE,results=hide>>=

#=======================================
# CHAP : Figure : TotalReturns
#=======================================
####################################
# Graph total returns
####################################

N_vichy_real=read.coda("simulation/N_vichy_realCODAchain1.txt","simulation/N_vichy_realCODAindex.txt")


N_vichy_real_q=array(NA,dim=c((T+20-15),5))
N_vichy_q=array(NA,dim=c(T,5))

for (t in 1:T){
	N_vichy_q[t,]=quantile(N_vichy[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
}

#Attention é l'année 30 oé estimation des passages é Vichy car année jugée incompléte
for (t in 1:(T-T+22)){
	N_vichy_real_q[t,]=quantile(N_vichy_real[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
}
for(t in (T-T+23):(T-T+23)){
	N_vichy_real_q[(t+7),]=quantile(N_vichy_real[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
}

#-----------------------------
# Graph
#-----------------------------
png(filename="C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/simulation/2014.05.30/_outputAllier_TotalReturns.png",width=800,height=800)

par(mfrow=c(1,2))


plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="With stocking",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")

for(i in 3:30){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_real_q[i,5],i+0.15,N_vichy_real_q[i,5])
	segments(i,N_vichy_real_q[i,4],i,N_vichy_real_q[i,5])
	#5%
	segments(i-0.15,N_vichy_real_q[i,1],i+0.15,N_vichy_real_q[i,1])
	segments(i,N_vichy_real_q[i,2],i,N_vichy_real_q[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q[i,2],N_vichy_real_q[i,2],N_vichy_real_q[i,4],N_vichy_real_q[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_real_q[i,3],i+0.3,N_vichy_real_q[i,3])
}


data_vichy=c(
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,393,267,515,
		380,400,541,1238,NA,
		510,950,572,421,491,
		227,755,861,819)



points(x=seq(23,T,1),data_vichy[23:T],pch=16)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="Simulation without stocking",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")


for(i in 3:6){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_real_q[i,5],i+0.15,N_vichy_real_q[i,5])
	segments(i,N_vichy_real_q[i,4],i,N_vichy_real_q[i,5])
	#5%
	segments(i-0.15,N_vichy_real_q[i,1],i+0.15,N_vichy_real_q[i,1])
	segments(i,N_vichy_real_q[i,2],i,N_vichy_real_q[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q[i,2],N_vichy_real_q[i,2],N_vichy_real_q[i,4],N_vichy_real_q[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_real_q[i,3],i+0.3,N_vichy_real_q[i,3])
}



for(i in 7:T){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_q[i,5],i+0.15,N_vichy_q[i,5])
	segments(i,N_vichy_q[i,4],i,N_vichy_q[i,5])
	#5%
	segments(i-0.15,N_vichy_q[i,1],i+0.15,N_vichy_q[i,1])
	segments(i,N_vichy_q[i,2],i,N_vichy_q[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_q[i,2],N_vichy_q[i,2],N_vichy_q[i,4],N_vichy_q[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_q[i,3],i+0.3,N_vichy_q[i,3])
}


dev.off()

@
<<Fig_TotalReturns_proj20years, echo=FALSE, eval=FALSE,results=hide>>=
	

N_vichy_2_un=read.coda(str_c(un,"N_vichyCODAchain1.txt"),str_c(un,"N_vichyCODAindex.txt"))
N_vichy_2_deux=read.coda(str_c(deux,"N_vichyCODAchain1.txt"),str_c(deux,"N_vichyCODAindex.txt"))
N_vichy_2_trois=read.coda(str_c(trois,"N_vichyCODAchain1.txt"),str_c(trois,"N_vichyCODAindex.txt"))

N_vichy_2_q_un=array(0,dim=c(43,5))
N_vichy_2_q_deux=array(0,dim=c(43,5))
N_vichy_2_q_trois=array(0,dim=c(43,5))


for (t in 1:43){
	N_vichy_2_q_un[t,]=quantile(N_vichy_2_un[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	N_vichy_2_q_deux[t,]=quantile(N_vichy_2_deux[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	N_vichy_2_q_trois[t,]=quantile(N_vichy_2_trois[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
}

#==========================================
# CHAP : Figure_un : TotalReturns_proj20years
#==========================================

# Graph projection 20 years

#------------------
# Graph
#------------------
png(filename=str_c(imgwd,"simulation/TotalReturns_proj20years_un.png"),width=800,height=800)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+20+0.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="20 years projection without stocking",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T,46,T+20),
		labels=c(1975,1980,1990,2000,2013,2020,2033),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")




for(i in 3:22){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_real_q_un[i,5],i+0.15,N_vichy_real_q_un[i,5])
	segments(i,N_vichy_real_q_un[i,4],i,N_vichy_real_q_un[i,5])
	#5%
	segments(i-0.15,N_vichy_real_q_un[i,1],i+0.15,N_vichy_real_q_un[i,1])
	segments(i,N_vichy_real_q_un[i,2],i,N_vichy_real_q_un[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_un[i,2],N_vichy_real_q_un[i,2],N_vichy_real_q_un[i,4],N_vichy_real_q_un[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_real_q_un[i,3],i+0.3,N_vichy_real_q_un[i,3])
}


data_vichy=c(
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,393,267,515,
		380,400,541,1238,662,
		510,950,572,421,491,
		227,755,861,819)
points(x=seq(23,T,1),data_vichy[23:T],pch=16)






for(i in (T+1):(T+20)){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_2_q_un[i-17,5],i+0.15,N_vichy_2_q_un[i-17,5])
	segments(i,N_vichy_2_q_un[i-17,4],i,N_vichy_2_q_un[i-17,5])
	#5%
	segments(i-0.15,N_vichy_2_q_un[i-17,1],i+0.15,N_vichy_2_q_un[i-17,1])
	segments(i,N_vichy_2_q_un[i-17,2],i,N_vichy_2_q_un[i-17,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_2_q_un[i-17,2],N_vichy_2_q_un[i-17,2],N_vichy_2_q_un[i-17,4],N_vichy_2_q_un[i-17,4]),col="orange")
	#median
	segments(i-0.3,N_vichy_2_q_un[i-17,3],i+0.3,N_vichy_2_q_un[i-17,3])
}


dev.off()

#==========================================
# CHAP : Figure_un : TotalReturns_proj20years
#==========================================

# Graph projection 20 years

#------------------
# Graph
#------------------
png(filename=str_c(imgwddeux,"simulation/TotalReturns_proj20years_deux.png"),width=800,height=800)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+20+0.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="20 years projection without stocking",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T,46,T+20),
		labels=c(1975,1980,1990,2000,2013,2020,2033),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")




for(i in 3:22){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_real_q_deux[i,5],i+0.15,N_vichy_real_q_deux[i,5])
	segments(i,N_vichy_real_q_deux[i,4],i,N_vichy_real_q_deux[i,5])
	#5%
	segments(i-0.15,N_vichy_real_q_deux[i,1],i+0.15,N_vichy_real_q_deux[i,1])
	segments(i,N_vichy_real_q_deux[i,2],i,N_vichy_real_q_deux[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_deux[i,2],N_vichy_real_q_deux[i,2],N_vichy_real_q_deux[i,4],N_vichy_real_q_deux[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_real_q_deux[i,3],i+0.3,N_vichy_real_q_deux[i,3])
}


data_vichy=c(
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,393,267,515,
		380,400,541,1238,662,
		510,950,572,421,491,
		227,755,861,819)
points(x=seq(23,T,1),data_vichy[23:T],pch=16)






for(i in (T+1):(T+20)){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_2_q_deux[i-17,5],i+0.15,N_vichy_2_q_deux[i-17,5])
	segments(i,N_vichy_2_q_deux[i-17,4],i,N_vichy_2_q_deux[i-17,5])
	#5%
	segments(i-0.15,N_vichy_2_q_deux[i-17,1],i+0.15,N_vichy_2_q_deux[i-17,1])
	segments(i,N_vichy_2_q_deux[i-17,2],i,N_vichy_2_q_deux[i-17,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_2_q_deux[i-17,2],N_vichy_2_q_deux[i-17,2],N_vichy_2_q_deux[i-17,4],N_vichy_2_q_deux[i-17,4]),col="orange")
	#median
	segments(i-0.3,N_vichy_2_q_deux[i-17,3],i+0.3,N_vichy_2_q_deux[i-17,3])
}


dev.off()

#==========================================
# CHAP : Figure_trois : TotalReturns_proj20years
#==========================================

# Graph projection 20 years

#------------------
# Graph
#------------------
png(filename=str_c(imgwdtrois,"simulation/TotalReturns_proj20years_trois.png"),width=800,height=800)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+20+0.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="20 years projection without stocking",cex.main=2,cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T,46,T+20),
		labels=c(1975,1980,1990,2000,2013,2020,2033),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")




for(i in 3:22){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_real_q_trois[i,5],i+0.15,N_vichy_real_q_trois[i,5])
	segments(i,N_vichy_real_q_trois[i,4],i,N_vichy_real_q_trois[i,5])
	#5%
	segments(i-0.15,N_vichy_real_q_trois[i,1],i+0.15,N_vichy_real_q_trois[i,1])
	segments(i,N_vichy_real_q_trois[i,2],i,N_vichy_real_q_trois[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_trois[i,2],N_vichy_real_q_trois[i,2],N_vichy_real_q_trois[i,4],N_vichy_real_q_trois[i,4]),col="light grey")
	#median
	segments(i-0.3,N_vichy_real_q_trois[i,3],i+0.3,N_vichy_real_q_trois[i,3])
}


data_vichy=c(
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,NA,NA,NA,
		NA,NA,393,267,515,
		380,400,541,1238,662,
		510,950,572,421,491,
		227,755,861,819)
points(x=seq(23,T,1),data_vichy[23:T],pch=16)






for(i in (T+1):(T+20)){
	#whiskers
	#95%
	segments(i-0.15,N_vichy_2_q_trois[i-17,5],i+0.15,N_vichy_2_q_trois[i-17,5])
	segments(i,N_vichy_2_q_trois[i-17,4],i,N_vichy_2_q_trois[i-17,5])
	#5%
	segments(i-0.15,N_vichy_2_q_trois[i-17,1],i+0.15,N_vichy_2_q_trois[i-17,1])
	segments(i,N_vichy_2_q_trois[i-17,2],i,N_vichy_2_q_trois[i-17,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_2_q_trois[i-17,2],N_vichy_2_q_trois[i-17,2],N_vichy_2_q_trois[i-17,4],N_vichy_2_q_trois[i-17,4]),col="orange")
	#median
	segments(i-0.3,N_vichy_2_q_trois[i-17,3],i+0.3,N_vichy_2_q_trois[i-17,3])
}


dev.off()

@

\begin{figure}[h!]
          \centering
          \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwddeux}simulation/TotalReturns_proj20years_deux.png}
                  \caption{TotalReturns proj20years modèle SurfErrSeul}
                  \label{TotalReturns_proj20years_deux}
         \end{subfigure}%         
        ~%~%\qquad
        \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwdtrois}simulation/TotalReturns_proj20years_trois.png}
                  \caption{Threshold modèle SurfErr+SurfDev}
                  \label{TotalReturns proj20years_trois}
        \end{subfigure}          
        \hfill
        \begin{subfigure}{0.59\textwidth}
                  \centering
                  \includegraphics{\Sexpr{imgwd}simulation/TotalReturns_proj20years_un.png}
                  \caption{Threshold modèle GuillaumeMaJ}
                  \label{TotalReturns proj20years_un}
          \end{subfigure}%    
  \caption[Comparaison des 3 modèles : Distribution a posteriori
  des retours d'adultes à Vichy en l'absence de repeuplement]{Comparaison des 3
  modèles :
 Distribution a posteriori
  des retours d'adultes à Vichy.Les
  boxplots indiquent les quantiles à 2.5$^th$, 25$^th$,
  75$^th$ et 97.5$^th$. Les cercles plein indiquent les années pour lesquelles
  la station de comptage de Vichy est opérationnelle et fournit le nombre de
  retours d'adultes. Les boxplots orange correspondent aux estimations des
  retours d'adultes à Vichy pour les 20 prochaines années dans le cadre du
  scénario 1.}
  \label{TotalReturns_proj20years}
  \end{figure}



<<Fig_Threshold, echo=FALSE, eval=FALSE,results=hide>>=
	
#==================================
# CHAP : Figure : Threshold
#==================================


#------------------------
#Figure_un Graph
#------------------------
png(filename=str_c(imgwd,"simulation/Threshold_un.png"),width=800,height=800)

par(mfrow=c(1,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,20.5),xlab="Years",ylim=c(0,1),ylab=expression(italic(p^threshold)),main="",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,0.2,0.4,0.6,0.8,1),labels=c(0,0.2,0.4,0.6,0.8,1),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,9,20),
		labels=c(2014,2020,2033),
		cex.axis =1.5,las = 1,col = "black")

x=seq(1,20,1)



points(x,p_under_10_vichy_un,col="grey85",pch=16)
segments(x[1:19],p_under_10_vichy_un[1:19],x[2:20],p_under_10_vichy_un[2:20],col="grey85")

points(x,p_under_50_vichy_un,col="grey75",pch=16)
segments(x[1:19],p_under_50_vichy_un[1:19],x[2:20],p_under_50_vichy_un[2:20],col="grey75")

points(x,p_under_100_vichy_un,col="grey65",pch=16)
segments(x[1:19],p_under_100_vichy_un[1:19],x[2:20],p_under_100_vichy_un[2:20],col="grey65")

points(x,p_under_250_vichy_un,col="grey55",pch=16)
segments(x[1:19],p_under_250_vichy_un[1:19],x[2:20],p_under_250_vichy_un[2:20],col="grey55")

points(x,p_under_500_vichy_un,col="grey45",pch=16)
segments(x[1:19],p_under_500_vichy_un[1:19],x[2:20],p_under_500_vichy_un[2:20],col="grey45")


legend(15,1,legend=c(expression(p^treshold < 500),expression(p^treshold < 250),expression(p^treshold < 100),expression(p^treshold < 50),expression(p^treshold < 10)),
		pch=c(16,16,16,16,16),col=c("grey45","grey55","grey65","grey75","grey85"),bty="n" )


dev.off()

#------------------------
#Figure_deux Graph
#------------------------
png(filename=str_c(imgwddeux,"simulation/Threshold_deux.png"),width=800,height=800)

par(mfrow=c(1,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,20.5),xlab="Years",ylim=c(0,1),ylab=expression(italic(p^threshold)),main="",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,0.2,0.4,0.6,0.8,1),labels=c(0,0.2,0.4,0.6,0.8,1),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,9,20),
		labels=c(2014,2020,2033),
		cex.axis =1.5,las = 1,col = "black")

x=seq(1,20,1)



points(x,p_under_10_vichy_deux,col="grey85",pch=16)
segments(x[1:19],p_under_10_vichy_deux[1:19],x[2:20],p_under_10_vichy_deux[2:20],col="grey85")

points(x,p_under_50_vichy_deux,col="grey75",pch=16)
segments(x[1:19],p_under_50_vichy_deux[1:19],x[2:20],p_under_50_vichy_deux[2:20],col="grey75")

points(x,p_under_100_vichy_deux,col="grey65",pch=16)
segments(x[1:19],p_under_100_vichy_deux[1:19],x[2:20],p_under_100_vichy_deux[2:20],col="grey65")

points(x,p_under_250_vichy_deux,col="grey55",pch=16)
segments(x[1:19],p_under_250_vichy_deux[1:19],x[2:20],p_under_250_vichy_deux[2:20],col="grey55")

points(x,p_under_500_vichy_deux,col="grey45",pch=16)
segments(x[1:19],p_under_500_vichy_deux[1:19],x[2:20],p_under_500_vichy_deux[2:20],col="grey45")


legend(15,1,legend=c(expression(p^treshold < 500),expression(p^treshold < 250),expression(p^treshold < 100),expression(p^treshold < 50),expression(p^treshold < 10)),
		pch=c(16,16,16,16,16),col=c("grey45","grey55","grey65","grey75","grey85"),bty="n" )


dev.off()
#------------------------
#Figure_trois Graph
#------------------------
png(filename=str_c(imgwdtrois,"simulation/Threshold_trois.png"),width=800,height=800)

par(mfrow=c(1,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,20.5),xlab="Years",ylim=c(0,1),ylab=expression(italic(p^threshold)),main="",cex.lab=1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,0.2,0.4,0.6,0.8,1),labels=c(0,0.2,0.4,0.6,0.8,1),cex.axis = 1.5,las = 1,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,9,20),
		labels=c(2014,2020,2033),
		cex.axis =1.5,las = 1,col = "black")

x=seq(1,20,1)



points(x,p_under_10_vichy_trois,col="grey85",pch=16)
segments(x[1:19],p_under_10_vichy_trois[1:19],x[2:20],p_under_10_vichy_trois[2:20],col="grey85")

points(x,p_under_50_vichy_trois,col="grey75",pch=16)
segments(x[1:19],p_under_50_vichy_trois[1:19],x[2:20],p_under_50_vichy_trois[2:20],col="grey75")

points(x,p_under_100_vichy_trois,col="grey65",pch=16)
segments(x[1:19],p_under_100_vichy_trois[1:19],x[2:20],p_under_100_vichy_trois[2:20],col="grey65")

points(x,p_under_250_vichy_trois,col="grey55",pch=16)
segments(x[1:19],p_under_250_vichy_trois[1:19],x[2:20],p_under_250_vichy_trois[2:20],col="grey55")

points(x,p_under_500_vichy_trois,col="grey45",pch=16)
segments(x[1:19],p_under_500_vichy_trois[1:19],x[2:20],p_under_500_vichy_trois[2:20],col="grey45")


legend(15,1,legend=c(expression(p^treshold < 500),expression(p^treshold < 250),expression(p^treshold < 100),expression(p^treshold < 50),expression(p^treshold < 10)),
		pch=c(16,16,16,16,16),col=c("grey45","grey55","grey65","grey75","grey85"),bty="n" )


dev.off()
@

\begin{figure}[h!]
          \centering
          \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwddeux}simulation/Threshold_deux.png}
                  \caption{Threshold modèle SurfErrSeul}
                  \label{Threshold_deux}
         \end{subfigure}%         
        ~%~%\qquad
        \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwdtrois}simulation/Threshold_trois.png}
                  \caption{Threshold modèle SurfErr+SurfDev}
                  \label{Threshold_trois}
        \end{subfigure}          
        \hfill
        \begin{subfigure}{0.59\textwidth}
                  \centering
                  \includegraphics{\Sexpr{imgwd}simulation/Threshold_un.png}
                  \caption{Threshold modèle GuillaumeMaJ}
                  \label{Threshold_un}
          \end{subfigure}%    
  \caption[Comparaison des 3 modèles : évolution de la probabilité
  d'atteindre certains seuils]{Comparaison des 3 modèles :
  évolution de la probabilité p$^{threshold}$
  d'atteindre certains seuils arbitraires du nombre de retours d'adultes à
  Vichy pendant la période 2014 à 2033 dans le cadre du scénario 1.}
  \label{Threshold}
  \end{figure}


<<fig_pasfaite, echo=FALSE, eval=FALSE,results=hide>>=

#================================================
# ML
# CHAP : Contribution stocking en pourcentage
#================================================

pour_stocking_vichy=array(0,dim=c(5000,T))


for (t in 1:T){
	for (i in 1:5000){
		pour_stocking_vichy[i,t]= (S_vichy_real[i,t]-S_vichy[i,t])/S_vichy_real[i,t]  
	}
} 



pour_stocking_vichy_q=array(0,dim=c(T,5))


for (i in 1:T){
	pour_stocking_vichy_q[i,]=quantile(pour_stocking_vichy[,i],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	
}

min(pour_stocking_vichy_q)
max(pour_stocking_vichy_q)

#--------------------------
#Graph with all years
#--------------------------
png(filename="C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/simulation/2014.05.30/outputAllier_ContributionStockingAllierPopulation_.png",width=800,height=800)

par(mfrow=c(1,1))

plot(1,1,type="n",axes=FALSE,xlim=c(0.5,T+0.5),xlab="Years",ylim=c(0,1),ylab="%stocking",main="Contribution of stocking to adults returns",cex.lab = 1.5)

# trace l'axe des ordonnées
axis(2,at = c(0,0.2,0.4,0.6,0.8,1),labels=c(0,0.2,0.4,0.6,0.8,1),cex.axis = 1.2,las = 1,lwd=2,col = "black")
# trace l'axe des abscisses
axis(1,at = c(1,6,16,26,T),
		labels=c(1975,1980,1990,2000,2013),
		cex.axis = 1.2,las = 1,lwd=2,col = "black")

#text(T,15,labels=expression(italic("a.")))



for(i in 7:T){
	#whiskers
	#95%
	segments(i-0.15,pour_stocking_vichy_q[i,5],i+0.15,pour_stocking_vichy_q[i,5])
	segments(i,pour_stocking_vichy_q[i,4],i,pour_stocking_vichy_q[i,5])
	#5%
	segments(i-0.15,pour_stocking_vichy_q[i,1],i+0.15,pour_stocking_vichy_q[i,1])
	segments(i,pour_stocking_vichy_q[i,2],i,pour_stocking_vichy_q[i,1])
	#boxplot
	polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(pour_stocking_vichy_q[i,2],pour_stocking_vichy_q[i,2],pour_stocking_vichy_q[i,4],pour_stocking_vichy_q[i,4]),col="light grey")
	#median
	segments(i-0.3,pour_stocking_vichy_q[i,3],i+0.3,pour_stocking_vichy_q[i,3])
}


dev.off()
@

  \section{Scénario : Amélioration de la survie de 50\%}
<<Fig_AmeliorationSurv50, echo=FALSE, eval=FALSE,results=hide>>=
unsim<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/SimulationImprovementSurvival50%/2014_05_30/" #Modèle Guillaume 2014.05.30
#deuxsim<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/2014_09/SurfErrSeul/"#SurfErrSeul
troissim<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/data/CODA/SimulationImprovementSurvival50%/2014_10_10_SurfErr+SurfDev/"#SurfERR+SurfDev
imgwdsim<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_05_30/simulation/"
#imgwddeuxsim<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_09_26SurfERR+SurfDev/"
imgwdtroissim<-"C:/Users/LOGRAMI/workspace/ModeleDynamiquePop/img/2014_09_26SurfERR+SurfDev/simulation/"

##################################
# CHAP: Improvement survival 50% #
##################################
	
	#=====================
	# SEC: Returns Vichy
	#=====================
	N_vichy_real_unsim=read.coda(str_c(unsim,"N_vichyCODAchain1.txt"),str_c(unsim,"N_vichyCODAindex.txt"))#,2001,10000)
	N_vichy_real_troissim=read.coda(str_c(troissim,"N_vichyCODAchain1.txt"),str_c(troissim,"N_vichyCODAindex.txt"))#,2001,10000)
	
	N_vichy_real_q_unsim=array(0,dim=c(42,5))
	N_vichy_real_q_troissim=array(0,dim=c(42,5))
	
	for (t in 1:42){
		N_vichy_real_q_unsim[t,]=quantile(N_vichy_real_unsim[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
		N_vichy_real_q_troissim[t,]=quantile(N_vichy_real_troissim[,t],probs=c(0.025,0.25,0.5,0.75,0.975),names=FALSE)
	}
		#--------------------------------------------------------------------------------------
		#Figure_un : ANNUAL ADULT RETURN 20 years projection - improvement 50% old level survival
		#--------------------------------------------------------------------------------------
		png(filename=str_c(imgwdsim,"SimulationImprovement50_un.png"),width=800,height=800)
		
		par(mfrow=c(1,1),col.lab="grey25",col.axis="grey55",col.main="grey25")
		
			
		plot(1,1,type="n",axes=FALSE,xlim=c(0.5,57.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="20 years projection - improvement 50% old level survival",cex.lab = 1.5,cex.main=2)
		
		# trace l'axe des ordonnées
		axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "grey55")
		# trace l'axe des abscisses
		axis(1,at = c(1,6,16,26,39,46,59),
				labels=c(1975,1980,1990,2000,2013,2020,2033),
				cex.axis = 1.2,las = 1,lwd=2,col = "grey55")
				
		for(i in 3:22){
			#whiskers
			#95%
			segments(i-0.15,N_vichy_real_q_unsim[i,5],i+0.15,N_vichy_real_q_unsim[i,5])
			segments(i,N_vichy_real_q_unsim[i,4],i,N_vichy_real_q_unsim[i,5])
			#5%
			segments(i-0.15,N_vichy_real_q_unsim[i,1],i+0.15,N_vichy_real_q_unsim[i,1])
			segments(i,N_vichy_real_q_unsim[i,2],i,N_vichy_real_q_unsim[i,1])
			#boxplot
			polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_unsim[i,2],N_vichy_real_q_unsim[i,2],N_vichy_real_q_unsim[i,4],N_vichy_real_q_unsim[i,4]),col="grey85")
			#median
			segments(i-0.3,N_vichy_real_q_unsim[i,3],i+0.3,N_vichy_real_q_unsim[i,3])
		}
				
		data_vichy=c(
				NA,NA,NA,NA,NA,
				NA,NA,NA,NA,NA,
				NA,NA,NA,NA,NA,
				NA,NA,NA,NA,NA,
				NA,NA,393,267,515,
				380,400,541,1238,657,
				510,950,572,421,491,
				227,755,861,819)
			
		points(x=seq(23,T,1),data_vichy[23:T],pch=16)
				
		for(i in (T+1):(T+20)){
			#whiskers
			#95%
			segments(i-0.15,N_vichy_real_q_unsim[i-17,5],i+0.15,N_vichy_real_q_unsim[i-17,5])
			segments(i,N_vichy_real_q_unsim[i-17,4],i,N_vichy_real_q_unsim[i-17,5])
			#5%
			segments(i-0.15,N_vichy_real_q_unsim[i-17,1],i+0.15,N_vichy_real_q_unsim[i-17,1])
			segments(i,N_vichy_real_q_unsim[i-17,2],i,N_vichy_real_q_unsim[i-17,1])
			#boxplot
			polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_unsim[i-17,2],N_vichy_real_q_unsim[i-17,2],N_vichy_real_q_unsim[i-17,4],N_vichy_real_q_unsim[i-17,4]),col="darkgoldenrod2")
			#median
			segments(i-0.3,N_vichy_real_q_unsim[i-17,3],i+0.3,N_vichy_real_q_unsim[i-17,3])
		}
		dev.off()
		
		#--------------------------------------------------------------------------------------
		#Figure_trois : ANNUAL ADULT RETURN 20 years projection - improvement 50% old level survival
		#--------------------------------------------------------------------------------------
		png(filename=str_c(imgwdtroissim,"SimulationImprovement50_trois.png"),width=800,height=800)
		
		par(mfrow=c(1,1),col.lab="grey25",col.axis="grey55",col.main="grey25")
		
		
		plot(1,1,type="n",axes=FALSE,xlim=c(0.5,57.5),xlab="Years",ylim=c(0,9000),ylab="Returns Vichy",main="20 years projection - improvement 50% old level survival",cex.lab = 1.5,cex.main=2)
		
		# trace l'axe des ordonnées
		axis(2,at = c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),labels=c(0,1000,2000,3000,4000,5000,6000,7000,8000,9000),cex.axis = 1.2,las = 1,lwd=2,col = "grey55")
		# trace l'axe des abscisses
		axis(1,at = c(1,6,16,26,39,46,59),
				labels=c(1975,1980,1990,2000,2013,2020,2033),
				cex.axis = 1.2,las = 1,lwd=2,col = "grey55")
		
		for(i in 3:22){
			#whiskers
			#95%
			segments(i-0.15,N_vichy_real_q_troissim[i,5],i+0.15,N_vichy_real_q_troissim[i,5])
			segments(i,N_vichy_real_q_troissim[i,4],i,N_vichy_real_q_troissim[i,5])
			#5%
			segments(i-0.15,N_vichy_real_q_troissim[i,1],i+0.15,N_vichy_real_q_troissim[i,1])
			segments(i,N_vichy_real_q_troissim[i,2],i,N_vichy_real_q_troissim[i,1])
			#boxplot
			polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_troissim[i,2],N_vichy_real_q_troissim[i,2],N_vichy_real_q_troissim[i,4],N_vichy_real_q_troissim[i,4]),col="grey85")
			#median
			segments(i-0.3,N_vichy_real_q_troissim[i,3],i+0.3,N_vichy_real_q_troissim[i,3])
		}
		
		data_vichy=c(
				NA,NA,NA,NA,NA,
				NA,NA,NA,NA,NA,
				NA,NA,NA,NA,NA,
				NA,NA,NA,NA,NA,
				NA,NA,393,267,515,
				380,400,541,1238,657,
				510,950,572,421,491,
				227,755,861,819)
		
		points(x=seq(23,T,1),data_vichy[23:T],pch=16)
		
		for(i in (T+1):(T+20)){
			#whiskers
			#95%
			segments(i-0.15,N_vichy_real_q_troissim[i-17,5],i+0.15,N_vichy_real_q_troissim[i-17,5])
			segments(i,N_vichy_real_q_troissim[i-17,4],i,N_vichy_real_q_troissim[i-17,5])
			#5%
			segments(i-0.15,N_vichy_real_q_troissim[i-17,1],i+0.15,N_vichy_real_q_troissim[i-17,1])
			segments(i,N_vichy_real_q_troissim[i-17,2],i,N_vichy_real_q_troissim[i-17,1])
			#boxplot
			polygon(c(i-0.3,i+0.3,i+0.3,i-0.3),c(N_vichy_real_q_troissim[i-17,2],N_vichy_real_q_troissim[i-17,2],N_vichy_real_q_troissim[i-17,4],N_vichy_real_q_troissim[i-17,4]),col="darkgoldenrod2")
			#median
			segments(i-0.3,N_vichy_real_q_troissim[i-17,3],i+0.3,N_vichy_real_q_troissim[i-17,3])
		}
		dev.off()
		
	#======================
	# SEC: Threshold
	#======================

	under_10_vichy_unsim=array(0,dim=c(8000,20))
	under_50_vichy_unsim=array(0,dim=c(8000,20))
	under_100_vichy_unsim=array(0,dim=c(8000,20))
	under_250_vichy_unsim=array(0,dim=c(8000,20))
	under_500_vichy_unsim=array(0,dim=c(8000,20))
	
	under_10_vichy_troissim=array(0,dim=c(8000,20))
	under_50_vichy_troissim=array(0,dim=c(8000,20))
	under_100_vichy_troissim=array(0,dim=c(8000,20))
	under_250_vichy_troissim=array(0,dim=c(8000,20))
	under_500_vichy_troissim=array(0,dim=c(8000,20))
	
	
	for (t in 23:42){
		
		for (i in 1:8000){
			if(N_vichy_real_unsim[i,t] < 10){under_10_vichy_unsim[i,t-22]=1} 
			if(N_vichy_real_unsim[i,t] < 50){under_50_vichy_unsim[i,t-22]=1}
			if(N_vichy_real_unsim[i,t] < 100){under_100_vichy_unsim[i,t-22]=1}
			if(N_vichy_real_unsim[i,t] < 250){under_250_vichy_unsim[i,t-22]=1}
			if(N_vichy_real_unsim[i,t] < 500){under_500_vichy_unsim[i,t-22]=1}
			
			if(N_vichy_real_troissim[i,t] < 10){under_10_vichy_troissim[i,t-22]=1} 
			if(N_vichy_real_troissim[i,t] < 50){under_50_vichy_troissim[i,t-22]=1}
			if(N_vichy_real_troissim[i,t] < 100){under_100_vichy_troissim[i,t-22]=1}
			if(N_vichy_real_troissim[i,t] < 250){under_250_vichy_troissim[i,t-22]=1}
			if(N_vichy_real_troissim[i,t] < 500){under_500_vichy_troissim[i,t-22]=1}
			
		}
	}
	
	p_under_10_vichy_unsim=rep(0,20)
	p_under_50_vichy_unsim=rep(0,20)
	p_under_100_vichy_unsim=rep(0,20)
	p_under_250_vichy_unsim=rep(0,20)
	p_under_500_vichy_unsim=rep(0,20)
	
	p_under_10_vichy_troissim=rep(0,20)
	p_under_50_vichy_troissim=rep(0,20)
	p_under_100_vichy_troissim=rep(0,20)
	p_under_250_vichy_troissim=rep(0,20)
	p_under_500_vichy_troissim=rep(0,20)
	
	for (t in 1:20){
		p_under_10_vichy_unsim[t]=mean(under_10_vichy_unsim[,t])
		p_under_50_vichy_unsim[t]=mean(under_50_vichy_unsim[,t])
		p_under_100_vichy_unsim[t]=mean(under_100_vichy_unsim[,t])
		p_under_250_vichy_unsim[t]=mean(under_250_vichy_unsim[,t])
		p_under_500_vichy_unsim[t]=mean(under_500_vichy_unsim[,t])
		
		p_under_10_vichy_troissim[t]=mean(under_10_vichy_troissim[,t])
		p_under_50_vichy_troissim[t]=mean(under_50_vichy_troissim[,t])
		p_under_100_vichy_troissim[t]=mean(under_100_vichy_troissim[,t])
		p_under_250_vichy_troissim[t]=mean(under_250_vichy_troissim[,t])
		p_under_500_vichy_troissim[t]=mean(under_500_vichy_troissim[,t])
	}
		
		#-----------------------------------------------------------------------------
		# Figure_un : THRESHOLD 20 years projection - improvement 50% old level survival
		#-----------------------------------------------------------------------------
		png(filename=str_c(imgwdsim,"Threshold_50_un.png"),width=800,height=800)		
		par(mar=c(4,7.1,2,0.5),col.lab="grey25",col.axis="grey55",col.main="grey25")
		
		par(mfrow=c(1,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)
		
		plot(1,1,type="n",axes=FALSE,xlim=c(0.5,20.5),xlab="Years",ylim=c(0,1),ylab=expression(italic(p^threshold)),main="20 years projection - improvement 50% old level survival",cex.lab=1.5,cex.main=2)
		
		# trace l'axe des ordonnées
		axis(2,at = c(0,0.2,0.4,0.6,0.8,1),labels=c(0,0.2,0.4,0.6,0.8,1),cex.axis = 1.5,las = 1,col = "grey55")
		# trace l'axe des abscisses
		axis(1,at = c(1,7,20),
				labels=c(2014,2020,2033),
				cex.axis = 1.5,las = 1,col = "grey55")
		
		x=seq(1,20,1)
		
		points(x,p_under_10_vichy_unsim,col="grey85",pch=16)
		segments(x[1:19],p_under_10_vichy_unsim[1:19],x[2:20],p_under_10_vichy_unsim[2:20],col="grey85")
		
		points(x,p_under_50_vichy_unsim,col="grey75",pch=16)
		segments(x[1:19],p_under_50_vichy_unsim[1:19],x[2:20],p_under_50_vichy_unsim[2:20],col="grey75")
		
		points(x,p_under_100_vichy_unsim,col="grey65",pch=16)
		segments(x[1:19],p_under_100_vichy_unsim[1:19],x[2:20],p_under_100_vichy_unsim[2:20],col="grey65")
		
		points(x,p_under_250_vichy_unsim,col="grey55",pch=16)
		segments(x[1:19],p_under_250_vichy_unsim[1:19],x[2:20],p_under_250_vichy_unsim[2:20],col="grey55")
		
		points(x,p_under_500_vichy_unsim,col="grey45",pch=16)
		segments(x[1:19],p_under_500_vichy_unsim[1:19],x[2:20],p_under_500_vichy_unsim[2:20],col="grey45")
		
		
		legend(15,1,legend=c(expression(p^treshold < 500),expression(p^treshold < 250),expression(p^treshold < 100),expression(p^treshold < 50),expression(p^treshold < 10)),
				pch=c(16,16,16,16,16),col=c("grey45","grey55","grey65","grey75","grey85"),bty="n" )
		dev.off()
		
		#-----------------------------------------------------------------------------
		# Figure_trois : THRESHOLD 20 years projection - improvement 50% old level survival
		#-----------------------------------------------------------------------------
		png(filename=str_c(imgwdtroissim,"Threshold_50_trois.png"),width=800,height=800)		
		par(mar=c(4,7.1,2,0.5),col.lab="grey25",col.axis="grey55",col.main="grey25")
		
		par(mfrow=c(1,1),mar=c(4,6.1,2,0.5),cex.lab=1.4, cex.lab=1.4)
		
		plot(1,1,type="n",axes=FALSE,xlim=c(0.5,20.5),xlab="Years",ylim=c(0,1),ylab=expression(italic(p^threshold)),main="20 years projection - improvement 50% old level survival",cex.lab=1.5,cex.main=2)
		
		# trace l'axe des ordonnées
		axis(2,at = c(0,0.2,0.4,0.6,0.8,1),labels=c(0,0.2,0.4,0.6,0.8,1),cex.axis = 1.5,las = 1,col = "grey55")
		# trace l'axe des abscisses
		axis(1,at = c(1,7,20),
				labels=c(2014,2020,2033),
				cex.axis = 1.5,las = 1,col = "grey55")
		
		x=seq(1,20,1)
		
		points(x,p_under_10_vichy_troissim,col="grey85",pch=16)
		segments(x[1:19],p_under_10_vichy_troissim[1:19],x[2:20],p_under_10_vichy_troissim[2:20],col="grey85")
		
		points(x,p_under_50_vichy_troissim,col="grey75",pch=16)
		segments(x[1:19],p_under_50_vichy_troissim[1:19],x[2:20],p_under_50_vichy_troissim[2:20],col="grey75")
		
		points(x,p_under_100_vichy_troissim,col="grey65",pch=16)
		segments(x[1:19],p_under_100_vichy_troissim[1:19],x[2:20],p_under_100_vichy_troissim[2:20],col="grey65")
		
		points(x,p_under_250_vichy_troissim,col="grey55",pch=16)
		segments(x[1:19],p_under_250_vichy_troissim[1:19],x[2:20],p_under_250_vichy_troissim[2:20],col="grey55")
		
		points(x,p_under_500_vichy_troissim,col="grey45",pch=16)
		segments(x[1:19],p_under_500_vichy_troissim[1:19],x[2:20],p_under_500_vichy_troissim[2:20],col="grey45")
		
		
		legend(15,1,legend=c(expression(p^treshold < 500),expression(p^treshold < 250),expression(p^treshold < 100),expression(p^treshold < 50),expression(p^treshold < 10)),
				pch=c(16,16,16,16,16),col=c("grey45","grey55","grey65","grey75","grey85"),bty="n" )
		dev.off()
@


\begin{figure}[h!]
          \centering
          
        \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwdtroissim}SimulationImprovement50_trois.png}
                  \caption{SimulationImprovement50 modèle SurfErr+SurfDev}
                  \label{SimulationImprovement50_trois}
        \end{subfigure}          
        \hfill
        \begin{subfigure}{0.59\textwidth}
                  \centering
                  \includegraphics{\Sexpr{imgwdsim}SimulationImprovement50_un.png}
                  \caption{SimulationImprovement50 modèle GuillaumeMaJ}
                  \label{SimulationImprovement50_un}
          \end{subfigure}%    
  \caption[Comparaison des 2 modèles : Distribution a posteriori
  des retours d'adultes à Vichy]{Comparaison des 2 modèles :
 Distribution a posteriori
  des retours d'adultes à Vichy dans le cadre du scénario 5.}
  \label{SimulationImprovement50}
  \end{figure}
  
  \begin{figure}[h!]
          \centering
         \begin{subfigure}{0.59\textwidth}
                  %\centering
                  \includegraphics{\Sexpr{imgwdtroissim}Threshold_50_trois.png}
                  \caption{Threshold 50\% modèle SurfErr+SurfDev}
                  \label{Threshold50_trois}
        \end{subfigure}          
        \hfill
        \begin{subfigure}{0.59\textwidth}
                  \centering
                  \includegraphics{\Sexpr{imgwdsim}Threshold_50_un.png}
                  \caption{Threshold 50\% modèle GuillaumeMaJ}
                  \label{Threshold50_un}
          \end{subfigure}%    
  \caption[Comparaison des 2 modèles : évolution de la probabilité
  d'atteindre certains seuils]{Comparaison des 2 modèles :
  évolution de la probabilité p$^{threshold}$
  d'atteindre certains seuils arbitraires du nombre de retours d'adultes à
  Vichy pendant la période 2014 à 2033 dans le cadre du scénario 5.}
  \label{Threshold}
  \end{figure}
\maketitle


\end{document}
